<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>React æ€§èƒ½ä¼˜åŒ–å¤§æŒ‘æˆ˜ | ğŸ‘¨ğŸ½â€ğŸ’»å‰ç«¯æ¼«æ¸¸æŒ‡å—</title>
    <meta name="description" content="Never Stop Learning">
    <link rel="icon" href="/bookNotes/favicon.ico">
    
    <link rel="preload" href="/bookNotes/assets/css/0.styles.02a9e5b3.css" as="style"><link rel="preload" href="/bookNotes/assets/js/app.a5c1f5ee.js" as="script"><link rel="preload" href="/bookNotes/assets/js/73.2a333618.js" as="script"><link rel="prefetch" href="/bookNotes/assets/js/10.7897844d.js"><link rel="prefetch" href="/bookNotes/assets/js/11.daa46aa2.js"><link rel="prefetch" href="/bookNotes/assets/js/12.19efc583.js"><link rel="prefetch" href="/bookNotes/assets/js/13.5b7f839d.js"><link rel="prefetch" href="/bookNotes/assets/js/14.47b4842d.js"><link rel="prefetch" href="/bookNotes/assets/js/15.959aa0c7.js"><link rel="prefetch" href="/bookNotes/assets/js/16.e07efd9a.js"><link rel="prefetch" href="/bookNotes/assets/js/17.06df2fb1.js"><link rel="prefetch" href="/bookNotes/assets/js/18.40dee455.js"><link rel="prefetch" href="/bookNotes/assets/js/19.ea09a6c5.js"><link rel="prefetch" href="/bookNotes/assets/js/2.2daf200c.js"><link rel="prefetch" href="/bookNotes/assets/js/20.ffb27053.js"><link rel="prefetch" href="/bookNotes/assets/js/21.33f73e1d.js"><link rel="prefetch" href="/bookNotes/assets/js/22.9e99b0e5.js"><link rel="prefetch" href="/bookNotes/assets/js/23.5417826f.js"><link rel="prefetch" href="/bookNotes/assets/js/24.59000dfc.js"><link rel="prefetch" href="/bookNotes/assets/js/25.acc91333.js"><link rel="prefetch" href="/bookNotes/assets/js/26.6af21f36.js"><link rel="prefetch" href="/bookNotes/assets/js/27.3d2e96f4.js"><link rel="prefetch" href="/bookNotes/assets/js/28.262d38c6.js"><link rel="prefetch" href="/bookNotes/assets/js/29.1eca77c6.js"><link rel="prefetch" href="/bookNotes/assets/js/3.2e998a1c.js"><link rel="prefetch" href="/bookNotes/assets/js/30.af641b29.js"><link rel="prefetch" href="/bookNotes/assets/js/31.3c9c863c.js"><link rel="prefetch" href="/bookNotes/assets/js/32.07ea838c.js"><link rel="prefetch" href="/bookNotes/assets/js/33.acab53c4.js"><link rel="prefetch" href="/bookNotes/assets/js/34.48dd7240.js"><link rel="prefetch" href="/bookNotes/assets/js/35.7c3ec624.js"><link rel="prefetch" href="/bookNotes/assets/js/36.ccd745ec.js"><link rel="prefetch" href="/bookNotes/assets/js/37.005d8f1b.js"><link rel="prefetch" href="/bookNotes/assets/js/38.fc6a5f21.js"><link rel="prefetch" href="/bookNotes/assets/js/39.44489367.js"><link rel="prefetch" href="/bookNotes/assets/js/4.dd5fac1d.js"><link rel="prefetch" href="/bookNotes/assets/js/40.34c225a3.js"><link rel="prefetch" href="/bookNotes/assets/js/41.1e7d641f.js"><link rel="prefetch" href="/bookNotes/assets/js/42.236029dd.js"><link rel="prefetch" href="/bookNotes/assets/js/43.09a1cad0.js"><link rel="prefetch" href="/bookNotes/assets/js/44.8165a802.js"><link rel="prefetch" href="/bookNotes/assets/js/45.01f5f11f.js"><link rel="prefetch" href="/bookNotes/assets/js/46.46b782a7.js"><link rel="prefetch" href="/bookNotes/assets/js/47.1ec61019.js"><link rel="prefetch" href="/bookNotes/assets/js/48.625d747e.js"><link rel="prefetch" href="/bookNotes/assets/js/49.f97abe71.js"><link rel="prefetch" href="/bookNotes/assets/js/5.dd4a8225.js"><link rel="prefetch" href="/bookNotes/assets/js/50.68dee525.js"><link rel="prefetch" href="/bookNotes/assets/js/51.583184a8.js"><link rel="prefetch" href="/bookNotes/assets/js/52.c7af0993.js"><link rel="prefetch" href="/bookNotes/assets/js/53.b647ed86.js"><link rel="prefetch" href="/bookNotes/assets/js/54.a5fbaa3d.js"><link rel="prefetch" href="/bookNotes/assets/js/55.a7b560d2.js"><link rel="prefetch" href="/bookNotes/assets/js/56.33015b4d.js"><link rel="prefetch" href="/bookNotes/assets/js/57.80ffe644.js"><link rel="prefetch" href="/bookNotes/assets/js/58.11a6edd1.js"><link rel="prefetch" href="/bookNotes/assets/js/59.e8bead8f.js"><link rel="prefetch" href="/bookNotes/assets/js/6.4505f2dd.js"><link rel="prefetch" href="/bookNotes/assets/js/60.cda1b788.js"><link rel="prefetch" href="/bookNotes/assets/js/61.16b57984.js"><link rel="prefetch" href="/bookNotes/assets/js/62.0476eb6a.js"><link rel="prefetch" href="/bookNotes/assets/js/63.f31d1faa.js"><link rel="prefetch" href="/bookNotes/assets/js/64.2e35d3be.js"><link rel="prefetch" href="/bookNotes/assets/js/65.e4ba2ad2.js"><link rel="prefetch" href="/bookNotes/assets/js/66.c2f247d4.js"><link rel="prefetch" href="/bookNotes/assets/js/67.393df1f2.js"><link rel="prefetch" href="/bookNotes/assets/js/68.875cabd4.js"><link rel="prefetch" href="/bookNotes/assets/js/69.54e25a4e.js"><link rel="prefetch" href="/bookNotes/assets/js/7.670f9f76.js"><link rel="prefetch" href="/bookNotes/assets/js/70.17e6d438.js"><link rel="prefetch" href="/bookNotes/assets/js/71.95131df7.js"><link rel="prefetch" href="/bookNotes/assets/js/72.83e3f4f8.js"><link rel="prefetch" href="/bookNotes/assets/js/74.13fba1a5.js"><link rel="prefetch" href="/bookNotes/assets/js/75.8ea1e0ca.js"><link rel="prefetch" href="/bookNotes/assets/js/76.1bd9ac71.js"><link rel="prefetch" href="/bookNotes/assets/js/77.470d01e4.js"><link rel="prefetch" href="/bookNotes/assets/js/78.29be0910.js"><link rel="prefetch" href="/bookNotes/assets/js/79.0da8502d.js"><link rel="prefetch" href="/bookNotes/assets/js/8.3c63f96d.js"><link rel="prefetch" href="/bookNotes/assets/js/80.f840286c.js"><link rel="prefetch" href="/bookNotes/assets/js/81.8dc38613.js"><link rel="prefetch" href="/bookNotes/assets/js/82.63f9f794.js"><link rel="prefetch" href="/bookNotes/assets/js/83.92125d6e.js"><link rel="prefetch" href="/bookNotes/assets/js/84.2dd13e00.js"><link rel="prefetch" href="/bookNotes/assets/js/85.90ac8d90.js"><link rel="prefetch" href="/bookNotes/assets/js/86.00a9730f.js"><link rel="prefetch" href="/bookNotes/assets/js/87.8a9e4f11.js"><link rel="prefetch" href="/bookNotes/assets/js/88.4b63d7ed.js"><link rel="prefetch" href="/bookNotes/assets/js/89.8cbf23b4.js"><link rel="prefetch" href="/bookNotes/assets/js/9.2033ddc1.js"><link rel="prefetch" href="/bookNotes/assets/js/90.871ef198.js"><link rel="prefetch" href="/bookNotes/assets/js/91.f87deae7.js"><link rel="prefetch" href="/bookNotes/assets/js/92.3eb8316d.js"><link rel="prefetch" href="/bookNotes/assets/js/93.ccc52aee.js"><link rel="prefetch" href="/bookNotes/assets/js/94.17ce85a1.js"><link rel="prefetch" href="/bookNotes/assets/js/95.490c860d.js"><link rel="prefetch" href="/bookNotes/assets/js/96.ed694272.js"><link rel="prefetch" href="/bookNotes/assets/js/97.e9cae244.js">
    <link rel="stylesheet" href="/bookNotes/assets/css/0.styles.02a9e5b3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/bookNotes/" class="home-link router-link-active"><!----> <span class="site-name">ğŸ‘¨ğŸ½â€ğŸ’»å‰ç«¯æ¼«æ¸¸æŒ‡å—</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/bookNotes/macosguide/" class="nav-link">MacOSé…ç½®</a></div><div class="nav-item"><a href="/bookNotes/weekstudy/" class="nav-link router-link-active">å‘¨å­¦ç³»åˆ—</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">å­¦ä¹ ç³»åˆ—</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/bookNotes/cssmagic/" class="nav-link">CSSæ­ç§˜</a></li><li class="dropdown-item"><!----> <a href="/bookNotes/algorithm/" class="nav-link">å‰ç«¯æ•°æ®ç»“æ„ä¸ç®—æ³•</a></li><li class="dropdown-item"><!----> <a href="/bookNotes/interview/" class="nav-link">é¢è¯•çŸ¥å¤šå°‘</a></li><li class="dropdown-item"><!----> <a href="/bookNotes/reactstatus/" class="nav-link">ReactçŠ¶æ€ç®¡ç†ä¸åŒæ„å®æˆ˜</a></li><li class="dropdown-item"><!----> <a href="/bookNotes/koa2/" class="nav-link">Koa2ç³»åˆ—</a></li><li class="dropdown-item"><!----> <a href="/bookNotes/nodejs/" class="nav-link">Nodejsç³»åˆ—</a></li></ul></div></div><div class="nav-item"><a href="http://h5web.cc/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  åšå®¢
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">GitHub</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/MarioGogogo" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHubåœ°å€
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/MarioGogogo/react" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ç®—æ³•ä»“åº“
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/bookNotes/macosguide/" class="nav-link">MacOSé…ç½®</a></div><div class="nav-item"><a href="/bookNotes/weekstudy/" class="nav-link router-link-active">å‘¨å­¦ç³»åˆ—</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">å­¦ä¹ ç³»åˆ—</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/bookNotes/cssmagic/" class="nav-link">CSSæ­ç§˜</a></li><li class="dropdown-item"><!----> <a href="/bookNotes/algorithm/" class="nav-link">å‰ç«¯æ•°æ®ç»“æ„ä¸ç®—æ³•</a></li><li class="dropdown-item"><!----> <a href="/bookNotes/interview/" class="nav-link">é¢è¯•çŸ¥å¤šå°‘</a></li><li class="dropdown-item"><!----> <a href="/bookNotes/reactstatus/" class="nav-link">ReactçŠ¶æ€ç®¡ç†ä¸åŒæ„å®æˆ˜</a></li><li class="dropdown-item"><!----> <a href="/bookNotes/koa2/" class="nav-link">Koa2ç³»åˆ—</a></li><li class="dropdown-item"><!----> <a href="/bookNotes/nodejs/" class="nav-link">Nodejsç³»åˆ—</a></li></ul></div></div><div class="nav-item"><a href="http://h5web.cc/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  åšå®¢
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">GitHub</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/MarioGogogo" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHubåœ°å€
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/MarioGogogo/react" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ç®—æ³•ä»“åº“
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/bookNotes/weekstudy/" class="sidebar-link">ç”¨å¥½è°·æ­Œ!!!(é‡ç‚¹)</a></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>2019å¹´38å‘¨</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>2019å¹´39å‘¨</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>2019å¹´40å‘¨</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>2019å¹´41å‘¨</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>2019å¹´42å‘¨</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>2019å¹´43å‘¨</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>2019å¹´44å‘¨</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>2019å¹´45å‘¨</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>2019å¹´46å‘¨</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>2019å¹´47å‘¨</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/bookNotes/weekstudy/Reactæ€§èƒ½ä¼˜åŒ–å¤§æŒ‘æˆ˜.html" class="active sidebar-link">React æ€§èƒ½ä¼˜åŒ–å¤§æŒ‘æˆ˜</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/bookNotes/weekstudy/Reactæ€§èƒ½ä¼˜åŒ–å¤§æŒ‘æˆ˜.html#ç¬¬ä¸€é¢˜" class="sidebar-link">ç¬¬ä¸€é¢˜</a></li><li class="sidebar-sub-header"><a href="/bookNotes/weekstudy/Reactæ€§èƒ½ä¼˜åŒ–å¤§æŒ‘æˆ˜.html#ç¬¬äºŒé¢˜" class="sidebar-link">ç¬¬äºŒé¢˜</a></li><li class="sidebar-sub-header"><a href="/bookNotes/weekstudy/Reactæ€§èƒ½ä¼˜åŒ–å¤§æŒ‘æˆ˜.html#ç¬¬ä¸‰é¢˜" class="sidebar-link">ç¬¬ä¸‰é¢˜</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/bookNotes/weekstudy/Reactæ€§èƒ½ä¼˜åŒ–å¤§æŒ‘æˆ˜.html#æå‡-react-æ•ˆèƒ½ï¼šä¿æŒ-virtual-dom-çš„ä¸€è‡´" class="sidebar-link">æå‡ React æ•ˆèƒ½ï¼šä¿æŒ virtual DOM çš„ä¸€è‡´</a></li><li class="sidebar-sub-header"><a href="/bookNotes/weekstudy/Reactæ€§èƒ½ä¼˜åŒ–å¤§æŒ‘æˆ˜.html#æå‡-react-æ•ˆèƒ½ï¼šä¸è¦è§¸ç™¼-render-function" class="sidebar-link">æå‡ React æ•ˆèƒ½ï¼šä¸è¦è§¸ç™¼ render function</a></li><li class="sidebar-sub-header"><a href="/bookNotes/weekstudy/Reactæ€§èƒ½ä¼˜åŒ–å¤§æŒ‘æˆ˜.html#shallowequal-èˆ‡-immutable-data-structures" class="sidebar-link">shallowEqual èˆ‡ Immutable data structures</a></li><li class="sidebar-sub-header"><a href="/bookNotes/weekstudy/Reactæ€§èƒ½ä¼˜åŒ–å¤§æŒ‘æˆ˜.html#purecomponent-çš„é™·é˜±" class="sidebar-link">PureComponent çš„é™·é˜±</a></li></ul></li><li class="sidebar-sub-header"><a href="/bookNotes/weekstudy/Reactæ€§èƒ½ä¼˜åŒ–å¤§æŒ‘æˆ˜.html#å‚è€ƒèµ„æ–™ï¼š" class="sidebar-link">å‚è€ƒèµ„æ–™ï¼š</a></li></ul></li><li><a href="/bookNotes/weekstudy/Redux vs Mobxä¹‹è¡ç”Ÿå±æ€§.html" class="sidebar-link">Redux vs Mobxä¹‹è¡ç”Ÿå±æ€§</a></li><li><a href="/bookNotes/weekstudy/å‰ç«¯è·¯ç”±åŸç†è§£æå’Œå®ç°.html" class="sidebar-link">å‰ç«¯è·¯ç”±åŸç†è§£æå’Œå®ç°</a></li><li><a href="/bookNotes/weekstudy/å–æ¶ˆfetchå¤šæ¬¡è¯·æ±‚å–æœ€å.html" class="sidebar-link">å–æ¶ˆfetchå¤šæ¬¡è¯·æ±‚å–æœ€å</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>2019å¹´48å‘¨</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>2019å¹´49å‘¨</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>2019å¹´51å‘¨</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>2019å¹´52å‘¨</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="react-æ€§èƒ½ä¼˜åŒ–å¤§æŒ‘æˆ˜"><a href="#react-æ€§èƒ½ä¼˜åŒ–å¤§æŒ‘æˆ˜" aria-hidden="true" class="header-anchor">#</a> React æ€§èƒ½ä¼˜åŒ–å¤§æŒ‘æˆ˜</h1> <div class="tip custom-block"><p class="custom-block-title">æç¤º</p> <p>åŸæ–‡åœ°å€ https://blog.techbridge.cc/2018/01/05/react-render-optimization/</p></div> <p>å‰é˜µå­æ­£åœ¨æ”¹é€ å…¬å¸çš„ä¸“æ¡ˆï¼Œè¯•äº†ä¸€äº›ä¸œè¥¿ä¹‹åå‘ç°è‡ªå·±å¯¹äº React çš„æ¸²æŸ“æœºåˆ¶å…¶å®ä¸å¤ªäº†è§£ï¼Œä¸å¤ªçŸ¥é“ render ä»€ä¹ˆæ—¶å€™ä¼šè¢«è§¦å‘ã€‚è€Œåæ¥æˆ‘å‘ç°ä¸åªæˆ‘è¿™æ ·ï¼Œå…¶å®è¿˜æœ‰æ»¡å¤šäººå¯¹è¿™æ•´ä¸ªæœºåˆ¶ä¸å¤ªç†Ÿæ‚‰ï¼Œå› æ­¤å†³å®šå†™è¿™ç¯‡æ¥åˆ†äº«è‡ªå·±çš„å¿ƒå¾—ã€‚</p> <p>å…¶å®ä¸çŸ¥é“æ€ä¹ˆä¼˜åŒ–å€’è¿˜å¥½ï¼Œæ›´æƒ¨çš„äº‹æƒ…æ˜¯ä½ è‡ªä»¥ä¸ºåœ¨ä¼˜åŒ–ï¼Œå…¶å®å´åœ¨æ‹–æ…¢æ•ˆèƒ½ï¼Œè€Œæ ¹æœ¬çš„åŸå› å°±æ˜¯å¯¹ React çš„æ•´ä¸ªæœºåˆ¶è¿˜ä¸å¤Ÿç†Ÿã€‚è¢«â€œä¼˜åŒ–â€è¿‡çš„ component åè€Œè¿˜å˜æ…¢äº†ï¼è¿™ä¸ªå°±ä¸¥é‡äº†ã€‚</p> <p>å› æ­¤ï¼Œè¿™ç¯‡æ–‡ç« ä¼šæ¶µç›–åˆ°ä»¥ä¸‹å‡ ä¸ªä¸»é¢˜ï¼š</p> <ol><li>ç»„ä»¶è·Ÿ PureComponent çš„å·®å¼‚</li> <li>shouldComponentUpdate çš„ä½œç”¨</li> <li>React çš„æ¸²æŸ“æœºåˆ¶</li> <li>ä¸ºä»€ä¹ˆè¦ç”¨</li></ol> <p>ä¸ºäº†åˆ¤åˆ«ä½ åˆ°åº•å¯¹ä»¥ä¸Šè¿™äº›ç†è§£å¤šå°‘ï¼Œæˆ‘ä»¬é©¬ä¸Šè¿›è¡Œå‡ ä¸ªå°æµ‹éªŒï¼æœ‰äº›æœ‰é™·é˜±ï¼Œè¯·çå¤§çœ¼ç›çœ‹æ¸…æ¥šå•¦ï¼</p> <h2 id="ç¬¬ä¸€é¢˜"><a href="#ç¬¬ä¸€é¢˜" aria-hidden="true" class="header-anchor">#</a> <a href="#%E7%AC%AC%E4%B8%80%E9%A1%8C" title="ç¬¬ä¸€é¢˜"></a>ç¬¬ä¸€é¢˜</h2> <p>ä»¥ä¸‹ç¨‹å¼ç æ˜¯ä¸€ä¸ªå¾ˆç®€å•çš„ç½‘é¡µï¼Œå°±ä¸€ä¸ªæŒ‰é’®è·Ÿä¸€ä¸ªå«åš<code>Content</code>çš„å…ƒä»¶è€Œå·²ï¼Œè€ŒæŒ‰é’®æŒ‰ä¸‹å»ä¹‹åä¼šæ”¹å˜<code>App</code>è¿™ä¸ª component çš„çŠ¶æ€ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Content</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;render content!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>Content<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      a<span class="token punctuation">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;render App!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleClick<span class="token punctuation">}</span><span class="token operator">&gt;</span>setState<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Content <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;container&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>è¯·é—®ï¼šå½“ä½ ç‚¹å‡»æŒ‰é’®ä¹‹åï¼Œconsole ä¼šè¾“å‡ºä»€ä¹ˆï¼Ÿ</p> <p>A.ä»€ä¹ˆéƒ½æ²¡æœ‰ï¼ˆApp è·Ÿ Content çš„æ¸²æŸ“åŠŸèƒ½éƒ½æ²¡è¢«æ‰§è¡Œåˆ°ï¼‰<br>
B.åªæœ‰<code>render App!</code>ï¼ˆåªæœ‰ App çš„ render åŠŸèƒ½è¢«æ‰§è¡Œåˆ°ï¼‰<br>
C. <code>render App!</code>ä»¥åŠ<code>render content!</code>ï¼ˆå…¶ä¸­çš„ render åŠŸèƒ½éƒ½è¢«æ‰§è¡Œåˆ°ï¼‰</p> <h2 id="ç¬¬äºŒé¢˜"><a href="#ç¬¬äºŒé¢˜" aria-hidden="true" class="header-anchor">#</a> <a href="#%E7%AC%AC%E4%BA%8C%E9%A1%8C" title="ç¬¬äºŒé¢˜"></a>ç¬¬äºŒé¢˜</h2> <p>ä»¥ä¸‹ç¨‹åºç ä¹Ÿå¾ˆç®€å•ï¼Œåˆ†ä¸ºä¸‰ä¸ªå…ƒç´ ï¼šAppï¼ŒTable è·Ÿ Rowï¼Œç”± App ä¼ é€’åˆ—è¡¨ç»™ Tableï¼ŒTable å†ç”¨ map æŠŠæ¯ä¸€ä¸ª Row éƒ½æ¸²æŸ“å‡ºæ¥ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Row</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> item<span class="token punctuation">,</span> style <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>tr style<span class="token operator">=</span><span class="token punctuation">{</span>style<span class="token punctuation">}</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>td<span class="token operator">&gt;</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>id<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>td<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>tr<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Table</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> list <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>
    <span class="token keyword">const</span> itemStyle <span class="token operator">=</span> <span class="token punctuation">{</span>
      color<span class="token punctuation">:</span> <span class="token string">&quot;red&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>table<span class="token operator">&gt;</span>
        <span class="token punctuation">{</span>list<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
          <span class="token operator">&lt;</span>Row key<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>id<span class="token punctuation">}</span> item<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">}</span> style<span class="token operator">=</span><span class="token punctuation">{</span>itemStyle<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>table<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    list<span class="token punctuation">:</span> <span class="token function">Array</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">val<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token punctuation">:</span> index <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      otherState<span class="token punctuation">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> list <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleClick<span class="token punctuation">}</span><span class="token operator">&gt;</span>change state<span class="token operator">!</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Table list<span class="token operator">=</span><span class="token punctuation">{</span>list<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>è€Œè¿™æ®µç¨‹åºç çš„é—®é¢˜å°±åœ¨äºæŒ‰ä¸‹æŒ‰é’®ä¹‹åï¼Œ<code>App</code>çš„æ¸²æŸ“åŠŸèƒ½è¢«è§¦å‘ï¼Œç„¶å<code>Table</code>çš„æ¸²æŸ“åŠŸèƒ½ä¹Ÿè¢«è§¦å‘ï¼Œæ‰€ä»¥é‡æ–°æ¸²æŸ“äº†ä¸€æ¬¡æ•´ä¸ªåˆ—è¡¨ã€‚</p> <p>å¯æ˜¯å‘¢ï¼Œæˆ‘ä»¬ç‚¹å‡»æŒ‰é’®ä¹‹åï¼Œ<code>list</code>æ ¹æœ¬æ²¡å˜ï¼Œå…¶å®æ˜¯ä¸éœ€è¦é‡æ–°æ¸²æŸ“çš„ï¼Œæ‰€ä»¥èªæ˜çš„å°æ˜æŠŠè¡¨ä» Component å˜æˆ PureComponentï¼Œåªè¦çŠ¶æ€è·Ÿ props æ²¡å˜å°±ä¸ä¼šé‡æ–°æ¸²æŸ“ï¼Œå˜æˆä¸‹é¢è¿™æ ·ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Table</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>list<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>
    <span class="token keyword">const</span> itemStyle <span class="token operator">=</span> <span class="token punctuation">{</span>
      color<span class="token punctuation">:</span> <span class="token string">'red'</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>table<span class="token operator">&gt;</span>
          <span class="token punctuation">{</span>list<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token operator">&lt;</span>Row key<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>id<span class="token punctuation">}</span> item<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">}</span> style<span class="token operator">=</span><span class="token punctuation">{</span>itemStyle<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>table<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// ä¸çŸ¥é“ä»€éº¼æ˜¯ PureComponent çš„æœ‹å‹ï¼Œå¯ä»¥æƒ³æˆä»–è‡ªå·±å¹«ä½ åŠ äº†ä¸‹é¢çš„ function</span>
<span class="token function">shouldComponentUpdate</span> <span class="token punctuation">(</span><span class="token parameter">nextProps<span class="token punctuation">,</span> nextState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token operator">!</span><span class="token function">shallowEqual</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">,</span> nextProps<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">shallowEqual</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">,</span> nextState<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>æŠŠ Table ä» Component è½¬æ¢æˆ PureComponent ä¹‹åï¼Œå¦‚æœæˆ‘ä»¬å†åšä¸€æ¬¡åŒæ ·çš„æ“ä½œï¼Œä¹Ÿå°±æ˜¯æŒ‰ä¸‹<code>change state</code>æŒ‰é’®æ”¹å˜ App çš„çŠ¶æ€ï¼Œè¿™æ—¶å€™ä¼šæå‡æ•ˆç‡å—ï¼Ÿ</p> <p>A.ä¼šï¼Œåœ¨è¿™æƒ…å†µä¸‹ PureComponent ä¼šæ¯” Component æœ‰æ•ˆç‡<br>
Bã€‚ä¸ä¼šï¼Œä¸¤è€…å·®ä¸å¤š<br>
C. ä¸ä¼šï¼Œåœ¨è¿™æƒ…å†µä¸‹ç»„ä»¶ä¼šæ¯” PureComponent æœ‰æ•ˆç‡</p> <h2 id="ç¬¬ä¸‰é¢˜"><a href="#ç¬¬ä¸‰é¢˜" aria-hidden="true" class="header-anchor">#</a> <a href="#%E7%AC%AC%E4%B8%89%E9%A1%8C" title="ç¬¬ä¸‰é¢˜"></a>ç¬¬ä¸‰é¢˜</h2> <p>æ¥ç€è®©æˆ‘æ¥çœ‹ä¸€ä¸ªè·Ÿéšä¸Šä¸€é¢˜å¾ˆåƒçš„ä¾‹å­ï¼Œåªæ˜¯è¿™æ¬¡æ¢æˆæŒ‰æŒ‰é’®ä»¥åä¼šæ”¹å˜ listï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Row</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> item<span class="token punctuation">,</span> style <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>tr style<span class="token operator">=</span><span class="token punctuation">{</span>style<span class="token punctuation">}</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>td<span class="token operator">&gt;</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>id<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>td<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>tr<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Table</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> list <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>
    <span class="token keyword">const</span> itemStyle <span class="token operator">=</span> <span class="token punctuation">{</span>
      color<span class="token punctuation">:</span> <span class="token string">&quot;red&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>table<span class="token operator">&gt;</span>
        <span class="token punctuation">{</span>list<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
          <span class="token operator">&lt;</span>Row key<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>id<span class="token punctuation">}</span> item<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">}</span> style<span class="token operator">=</span><span class="token punctuation">{</span>itemStyle<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>table<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    list<span class="token punctuation">:</span> <span class="token function">Array</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">val<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token punctuation">:</span> index <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      list<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token operator">...</span>this<span class="token punctuation">.</span>state<span class="token punctuation">.</span>list<span class="token punctuation">,</span> <span class="token number">1234567</span><span class="token punctuation">]</span> <span class="token comment">// å¢åŠ ä¸€å€‹å…ƒç´ </span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> list <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleClick<span class="token punctuation">}</span><span class="token operator">&gt;</span>change state<span class="token operator">!</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Table list<span class="token operator">=</span><span class="token punctuation">{</span>list<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>è¿™æ—¶å€™ Table çš„ PureComponent ä¼˜åŒ–å·²ç»æ²¡æœ‰ç”¨äº†ï¼Œå› ä¸ºåˆ—è¡¨å·²ç»å˜äº†ï¼Œæ‰€ä»¥ä¼šè§¦å‘ render å‡½æ•°ã€‚è¦ç»§ç»­ä¼˜åŒ–çš„è¯ï¼Œæ¯”è¾ƒå¸¸ç”¨çš„æ‰‹æ®µæ˜¯æŠŠ Row å˜æˆ PureComponentï¼Œè¿™æ ·å°±å¯ä»¥ç¡®ä¿ç›¸åŒçš„ Row ä¸ä¼šå†æ¬¡æ¸²æŸ“ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Row</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> item<span class="token punctuation">,</span> style <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>tr style<span class="token operator">=</span><span class="token punctuation">{</span>style<span class="token punctuation">}</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>td<span class="token operator">&gt;</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>id<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>td<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>tr<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Table</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> list <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>
    <span class="token keyword">const</span> itemStyle <span class="token operator">=</span> <span class="token punctuation">{</span>
      color<span class="token punctuation">:</span> <span class="token string">&quot;red&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>table<span class="token operator">&gt;</span>
        <span class="token punctuation">{</span>list<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
          <span class="token operator">&lt;</span>Row key<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>id<span class="token punctuation">}</span> item<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">}</span> style<span class="token operator">=</span><span class="token punctuation">{</span>itemStyle<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>table<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>è¯·é—®ï¼šæŠŠè¡Œä»ç»„ä»¶è½¬æ¢æˆ PureComponent ä¹‹åï¼Œå¦‚æœæˆ‘ä»¬å†åšä¸€æ¬¡åŒæ ·çš„æ“ä½œï¼Œä¹Ÿå°±æ˜¯ç‚¹å‡»<code>change state</code>æŒ‰é’®æ›´æ”¹åˆ—è¡¨ï¼Œè¿™æ—¶å€™ä¼šæå‡æ•ˆç‡å—ï¼Ÿ</p> <p>A.ä¼šï¼Œåœ¨è¿™æƒ…å†µä¸‹ PureComponent ä¼šæ¯” Component æœ‰æ•ˆç‡<br>
Bã€‚ä¸ä¼šï¼Œä¸¤è€…å·®ä¸å¤š<br>
C. ä¸ä¼šï¼Œåœ¨è¿™æƒ…å†µä¸‹ç»„ä»¶ä¼šæ¯” PureComponent æœ‰æ•ˆç‡</p> <p>åœ¨å…¬å¸ƒç­”æ¡ˆä¹‹å‰ï¼Œå…ˆå¸®å¤§å®¶ç®€å•å¤ä¹ ä¸€ä¸‹ React æ˜¯å¦‚ä½•æŠŠä½ çš„ç”»é¢æ¸²æŸ“å‡ºæ¥çš„ã€‚</p> <p>é¦–å…ˆï¼Œå¤§å®¶éƒ½çŸ¥é“ä½ åœ¨<code>render</code>è¿™ä¸ªåŠŸèƒ½é‡Œé¢å¯ä»¥å›ä¼ ä½ æƒ³æ¸²æŸ“çš„ä¸œè¥¿ï¼Œä¾‹å¦‚è¯´ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Content</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>Content<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>è¦æ³¨æ„çš„æ˜¯è¿™è¾¹ return çš„ä¸œè¥¿ä¸ä¼šç›´æ¥å°±æ”¾åˆ° DOM ä¸Šå»ï¼Œè€Œæ˜¯ä¼šå…ˆé€šè¿‡ä¸€å±‚ virtual DOMã€‚å…¶å®ä½ å¯ä»¥ç®€å•æŠŠè¿™ä¸ª virtual DOM æƒ³æˆ JavaScript çš„ç‰©ä»¶ï¼Œä¾‹å¦‚è¯´ä¸Šé¢çš„å†…å®¹æ¸²æŸ“å‡ºæ¥çš„ç»“æœå¯èƒ½æ˜¯ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  tagName<span class="token punctuation">:</span> <span class="token string">'div'</span><span class="token punctuation">,</span>
  children<span class="token punctuation">:</span> <span class="token string">'Content'</span>
<span class="token punctuation">}</span>
</code></pre></div><p>æœ€åä¸€æ­¥åˆ™æ˜¯ React è¿›è¡Œè™šæ‹Ÿ DOM å·®å¼‚ï¼ŒæŠŠä¸Šæ¬¡çš„è·Ÿè¿™æ¬¡çš„åšæ¯”è¾ƒï¼Œå¹¶ä¸”æŠŠç§»åŠ¨çš„éƒ¨åˆ†æ›´æ–°åˆ°çœŸçš„ DOM ä¸Šé¢å»ã€‚</p> <p>ç®€å•æ¥è¯´å‘¢ï¼Œå°±æ˜¯åœ¨ React Component ä»¥åŠ DOM ä¹‹é—´å¦å¤–æ·»åŠ äº†ä¸€ä¸ªè™šæ‹Ÿ DOMï¼Œå…ˆæŠŠä½ è¦æ¸²æŸ“çš„ä¸œè¥¿è½¬æˆè™šæ‹Ÿ DOMï¼Œå†æŠŠéœ€è¦æ›´æ–°çš„ä¸œè¥¿ update åˆ°çœŸçš„ DOM ä¸Šé¢å»ã€‚</p> <p>å¦‚æ­¤ä¸€æ¥ï¼Œå°±èƒ½å¤Ÿå‡å°‘è§¦ç¢°åˆ°çœŸçš„ DOM çš„æ¬¡æ•°å’Œæå‡æ€§èƒ½ã€‚</p> <p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æˆ‘ä»¬å®ä½œä¸€ä¸ªéå¸¸ç®€å•çš„ï¼ŒæŒ‰ä¸€ä¸ªæŒ‰é’®ä¹‹åå°±ä¼šæ”¹å˜ state çš„å°èŒƒä¾‹ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Content</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>text<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    text<span class="token punctuation">:</span> <span class="token string">&quot;hello&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      text<span class="token punctuation">:</span> <span class="token string">&quot;world&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleClick<span class="token punctuation">}</span><span class="token operator">&gt;</span>setState<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Content text<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>text<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>åœ¨ç¨‹å¼åˆšå¼€å§‹æ‰§è¡Œæ—¶ï¼Œå‘ˆç°çš„é¡ºåºæ˜¯è¿™æ ·çš„ï¼š</p> <ol><li>å‘¼å« App çš„ render</li> <li>å‘¼å«å†…å®¹çš„ render</li> <li>æ‹¿åˆ°è™šæ‹Ÿ DOM</li> <li>è·Ÿä¸Šæ¬¡çš„ virtual DOM åšæ¯”è¾ƒ</li> <li>æŠŠæ”¹å˜çš„åœ°æ–¹åº”ç”¨åˆ°çœŸçš„</li></ol> <p>è¿™æ—¶å€™çš„è™šæ‹Ÿ DOM æ•´ä½“åº”è¯¥ä¼šé•¿å¾—åƒè¿™æ ·ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  tagName<span class="token punctuation">:</span> <span class="token string">'div'</span><span class="token punctuation">,</span>
  children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      tagName<span class="token punctuation">:</span> <span class="token string">'button'</span><span class="token punctuation">,</span>
      children<span class="token punctuation">:</span> <span class="token string">'setState'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      tagName<span class="token punctuation">:</span> <span class="token string">'div'</span><span class="token punctuation">,</span>
      children<span class="token punctuation">:</span> <span class="token string">'hello'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>å½“ä½ ç‚¹å‡»æŒ‰é’®ï¼Œæ”¹å˜çŠ¶æ€äº†ä»¥åï¼Œæ‰§è¡Œé¡ºåºéƒ½è·Ÿåˆšåˆšä¸€æ ·ï¼š</p> <ol><li>å‘¼å« App çš„ render</li> <li>å‘¼å«å†…å®¹çš„ render</li> <li>æ‹¿åˆ°è™šæ‹Ÿ DOM</li></ol> <p>è¿™æ—¶å€™æ‹¿åˆ°çš„ virtual DOM åº”è¯¥ä¼šé•¿å¾—åƒè¿™æ ·ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  tagName<span class="token punctuation">:</span> <span class="token string">'div'</span><span class="token punctuation">,</span>
  children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      tagName<span class="token punctuation">:</span> <span class="token string">'button'</span><span class="token punctuation">,</span>
      children<span class="token punctuation">:</span> <span class="token string">'setState'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      tagName<span class="token punctuation">:</span> <span class="token string">'div'</span><span class="token punctuation">,</span>
      children<span class="token punctuation">:</span> <span class="token string">'world'</span> <span class="token comment">// åªæœ‰é€™é‚Šè®Šäº†</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>è€Œ React çš„è™šæ‹Ÿ DOM å·®å¼‚æ¼”ç®—æ³•ï¼Œå°±ä¼šå‘ç°åªæœ‰ä¸€ä¸ªåœ°æ–¹æ”¹å˜ï¼Œç„¶åæŠŠé‚£è¾¹çš„æ–‡å­—æ›¿æ¢æ‰ï¼Œå…¶ä»–éƒ¨åˆ†éƒ½ä¸ä¼šåŠ¨åˆ°ã€‚</p> <p>å…¶å®<a href="https://reactjs.org/docs/reconciliation.html#motivation" target="_blank" rel="noopener noreferrer">å®˜æ–¹æ–‡ä»¶<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>æŠŠè¿™ä¸€æ®µå†™å¾—å¾ˆå¥½ï¼š</p> <blockquote><p>ä½¿ç”¨ React æ—¶ï¼Œæ‚¨å¯ä»¥åœ¨å•ä¸ªæ—¶é—´ç‚¹å°† renderï¼ˆï¼‰å‡½æ•°è§†ä¸ºåˆ›å»º React å…ƒç´ æ ‘ã€‚åœ¨ä¸‹ä¸€ä¸ªçŠ¶æ€æˆ–é“å…·æ›´æ–°æ—¶ï¼Œè¯¥ renderï¼ˆï¼‰å‡½æ•°å°†è¿”å›ä¸åŒçš„ React å…ƒç´ æ ‘ã€‚ç„¶åï¼ŒReact éœ€è¦å¼„æ¸…æ¥šå¦‚ä½•æœ‰æ•ˆåœ°æ›´æ–° UI ä»¥åŒ¹é…æœ€æ–°çš„æ ‘ã€‚</p></blockquote> <p>å¤§æ„å°±æ˜¯ä½ å¯ä»¥æƒ³åƒæˆ render å‡½æ•°ä¼šå›ä¼ ä¸€ä¸ª React elements çš„ treeï¼Œç„¶å React ä¼šæŠŠè¿™æ¬¡çš„ tree è·Ÿä¸Šæ¬¡çš„åšæ¯”è¾ƒï¼Œå¹¶ä¸”å‘ç°å¦‚ä½•æœ‰æ•ˆç‡åœ°æŠŠè¿™å·®å¼‚ update åˆ° UI ä¸Šé¢å»ã€‚</p> <p>æ‰€ä»¥è¯´å‘¢ï¼Œå¦‚æœä½ è¦æˆåŠŸæ›´æ–°ç”»é¢ï¼Œä½ å¿…é¡»ç»è¿‡ä¸¤ä¸ªæ­¥éª¤ï¼š</p> <ol><li>æ¸²æŸ“åŠŸèƒ½</li> <li>è™šæ‹Ÿ DOM å·®å¼‚</li></ol> <p>å› æ­¤ï¼Œè¦ä¼˜åŒ–æ•ˆèƒ½çš„è¯ä½ æœ‰ä¸¤ä¸ªæ–¹å‘ï¼Œé‚£å°±æ˜¯ï¼š</p> <ol><li>ä¸è¦è§¦å‘æ¸²æŸ“åŠŸèƒ½</li> <li>ä¿æŒè™šæ‹Ÿ DOM çš„ä¸€è‡´</li></ol> <p>æˆ‘ä»¬å…ˆä»å¦å¤–å¼€å§‹å§ï¼</p> <h3 id="æå‡-react-æ•ˆèƒ½ï¼šä¿æŒ-virtual-dom-çš„ä¸€è‡´"><a href="#æå‡-react-æ•ˆèƒ½ï¼šä¿æŒ-virtual-dom-çš„ä¸€è‡´" aria-hidden="true" class="header-anchor">#</a> æå‡ React æ•ˆèƒ½ï¼šä¿æŒ virtual DOM çš„ä¸€è‡´</h3> <p>å› ä¸ºæœ‰äº† virtual DOM è¿™ä¸€å±‚çš„å®ˆæŠ¤ï¼Œé€šå¸¸ä½ ä¸å¿…å¤ªæ‹…å¿ƒ React çš„æ•ˆèƒ½ã€‚</p> <p>åƒæ˜¯æˆ‘ä»¬å¼€å¤´é—®ç­”çš„ç¬¬ä¸€é¢˜ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Content</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;render content!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>Content<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      a<span class="token punctuation">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;render App!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleClick<span class="token punctuation">}</span><span class="token operator">&gt;</span>setState<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Content <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;container&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>æ‚¨æ¯æ¬¡æŒ‰ä¸‹æŒ‰é’®ä¹‹åï¼Œç”±äº App çš„çŠ¶æ€æ”¹å˜äº†ï¼Œæ‰€ä»¥ä¼šå…ˆè§¦å‘ App çš„å‘ˆç°åŠŸèƒ½ï¼Œè€Œå› ä¸ºé‡Œé¢æœ‰å›ä¼ <code>&lt;Content /&gt;</code>ï¼Œæ‰€ä»¥ä¹Ÿä¼šè§¦å‘ Content çš„å‘ˆç°åŠŸèƒ½ã€‚</p> <p>å› æ­¤ä½ æ¯æŒ‰ä¸€æ¬¡æŒ‰é’®ï¼Œè¿™ä¸¤ä¸ªç»„ä»¶çš„ render function å°±ä¼šä¸ªåˆ«è¢«å‘¼å«ä¸€æ¬¡ã€‚æ‰€ä»¥ç­”æ¡ˆæ˜¯<code>C. render App! ä»¥åŠ render content!ï¼ˆå…©è€…çš„ render function éƒ½è¢«åŸ·è¡Œåˆ°ï¼‰</code></p> <p>å› ä¸ºæ˜¯è™šæ‹Ÿå¦‚æ­¤ï¼ŒçœŸçš„ DOM ä¸ä¼šæœ‰ä»»ä½•å˜åŒ–ã€‚å› ä¸ºåœ¨ virtual DOM diff çš„æ—¶å€™ï¼Œååº”ä¼šå‘ç°ä½ è¿™æ¬¡è·Ÿä¸Šæ¬¡çš„ virtual DOM é•¿å¾—ä¸€æ¨¡ä¸€æ ·ï¼ˆå› ä¸ºæ²¡æœ‰ä¸œè¥¿æ”¹å˜å˜›ï¼‰ï¼Œå°±ä¸ä¼šå¯¹ DOM åšä»»ä½•æ“ä½œã€‚</p> <p>å¦‚æœèƒ½ç»´æŒç»´æŒ virtual DOM çš„ç»“æ„ç›¸ä¼¼çš„è¯ï¼Œå¯ä»¥å‡å°‘ä¸€äº›é¢å¤–çš„æ“ä½œï¼Œåœ¨è¿™ç‚¹ä¸Šå…¶å®å¯ä»¥åšçš„ä¼˜åŒ–è¿˜å¾ˆå¤šï¼Œå¯ä»¥å‚è€ƒ<a href="https://reactjs.org/docs/reconciliation.html" target="_blank" rel="noopener noreferrer">å®˜æ–¹æ–‡ä»¶<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>ï¼Œé‡Œé¢å†™çš„å¾ˆè¯¦ç»†ã€‚</p> <h3 id="æå‡-react-æ•ˆèƒ½ï¼šä¸è¦è§¸ç™¼-render-function"><a href="#æå‡-react-æ•ˆèƒ½ï¼šä¸è¦è§¸ç™¼-render-function" aria-hidden="true" class="header-anchor">#</a> æå‡ React æ•ˆèƒ½ï¼šä¸è¦è§¸ç™¼ render function</h3> <p>è™½ç„¶ä¸å¿…å¤ªè¿‡æ‹…å¿ƒï¼Œä½†æ˜¯è™šæ‹Ÿ DOM å·®å¼‚ä¹Ÿæ˜¯éœ€è¦æ‰§è¡Œæ—¶é—´çš„ã€‚è™½ç„¶è¯´é€Ÿåº¦å¾ˆå¿«ï¼Œä½†å†å¿«ä¹Ÿæ¯”ä¸ä¸Šå®Œå…¨ä¸å‘¼å«æ¥çš„å¿«ï¼Œä½ è¯´æ˜¯å§ã€‚</p> <p>å¯¹äºè¿™ç§ã€Œæˆ‘ä»¬å·²ç»æ˜ç¡®çŸ¥é“ä¸è¯¥æœ‰å˜åŒ–ã€çš„äº‹å®ï¼Œæˆ‘ä»¬è¿æ¸²æŸ“éƒ½ä¸è¯¥å‘¼å«ï¼Œå› ä¸ºæ²¡å¿…è¦å˜›ï¼Œå†æ€ä¹ˆè°ƒç”¨éƒ½æ˜¯ä¸€æ ·çš„ç»“æœã€‚å¦‚æœ render æ²¡æœ‰è¢«å‘¼å«çš„è¯ï¼Œè¿ virtual DOM diff éƒ½ä¸éœ€è¦æ‰§è¡Œï¼Œåˆæå‡äº†ä¸€äº›æ€§èƒ½ã€‚</p> <p>åº”è¯¥ä½ å¬è¿‡æœ‰<code>shouldComponentUpdate</code>è¿™ä¸ªåŠŸèƒ½ï¼Œå°±æ˜¯æ¥åšè¿™ä»¶äº‹çš„ã€‚å¦‚æœä½ åœ¨è¿™ä¸ªå‡½æ•°ä¸­å›ä¼ å‡ï¼Œå°±ä¸ä¼šé‡æ–°å‘¼å«æ¸²æŸ“åŠŸèƒ½ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Content</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">shouldComponentUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;render content!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>Content<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      a<span class="token punctuation">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;render App!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleClick<span class="token punctuation">}</span><span class="token operator">&gt;</span>setState<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Content <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>åŠ ä¸Šå»ä¹‹åï¼Œä½ ä¼šå‘ç°æ— è®ºä½ æŒ‰å¤šæ¬¡æŒ‰é’®ï¼ŒContent çš„å‘ˆç°åŠŸèƒ½éƒ½ä¸ä¼šè¢«è§¦å‘ã€‚</p> <p>ä½†æ˜¯è¿™ä¸ªä¸œè¥¿è¯·å°å¿ƒä½¿ç”¨ï¼Œä¸€ä¸ªä¸æ³¨æ„ä½ å°†ä¼šç¢°åˆ° state è·Ÿ UI æ­ä¸ä¸Šçš„æ ·å­ï¼Œä¾‹å¦‚è¯´ state æ˜æ˜å˜æˆä¸–ç•Œï¼Œå¯æ˜¯ UI æ˜¾ç¤ºçš„è¿˜æ˜¯ Helloï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Content</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">shouldComponentUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>text<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    text<span class="token punctuation">:</span> <span class="token string">&quot;hello&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      text<span class="token punctuation">:</span> <span class="token string">&quot;world&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleClick<span class="token punctuation">}</span><span class="token operator">&gt;</span>setState<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Content text<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>text<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œç‚¹å‡»æŒ‰é’®ä¹‹åçŠ¶æ€ç¡®å®å˜ä¸º<code>world</code>ï¼Œä½†æ˜¯å› ä¸ºå†…å®¹çš„<code>shouldComponentUpdate</code>æ°¸è¿œéƒ½å›ä¼  falseï¼Œæ‰€ä»¥ä¸ä¼šå†æ¬¡è§¦å‘ renderï¼Œå°±çœ‹ä¸åˆ°å¯¹åº”çš„æ–°çš„çŠ¶æ€çš„ç”»é¢äº†ã€‚</p> <p>ä¸è¿‡è¿™æœ‰ç‚¹æç«¯ï¼Œå› ä¸ºé€šå¸¸æ°¸è¿œæ°¸è¿œéƒ½å›ä¼  falseï¼Œé™¤éä½ çœŸçš„ç¡®å®šè¿™ä¸ª component å®Œå…¨ä¸éœ€è¦ re-renderã€‚</p> <p>æ¯”èµ·è¿™ä¸ªï¼Œæœ‰ä¸€ä¸ªæ›´åˆç†çš„åˆ¤æ–­åŸºå‡†æ˜¯ï¼š</p> <blockquote><p>å¦‚æœæ¯ä¸€ä¸ªé“å…·è·ŸçŠ¶æ€éƒ½æ²¡æœ‰å˜ï¼Œé‚£å°±å›ä¼  false</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Content</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">shouldComponentUpdate</span><span class="token punctuation">(</span><span class="token parameter">nextProps<span class="token punctuation">,</span> nextState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">!</span><span class="token function">shallowEqual</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">,</span> nextProps<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">shallowEqual</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">,</span> nextState<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>text<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>å‡è®¾<code>this.props</code>æ˜¯ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  text<span class="token punctuation">:</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>è€Œ<code>nextProps</code>çš„è‹±æ–‡ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  text<span class="token punctuation">:</span> <span class="token string">&quot;world&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>åœ¨é‚£æ¯”è¾ƒçš„æ—¶å€™å°±ä¼šå‘ç°<code>props.text</code>å˜äº†ï¼Œå°±å¯ä»¥é¡ºç†æˆç« çš„å‘¼å«æ¸²æŸ“åŠŸèƒ½ã€‚å¦å¤–è¿˜æœ‰ä¸€ç‚¹ä¸€çš„è‹±æ–‡è¿™è¾¹ç”¨<code>shallowEqual</code>æ¥æ¯”è¾ƒå‰åçš„å·®å¼‚ï¼Œè€Œä¸æ˜¯ç”¨<code>deepEqual</code>ã€‚</p> <p>è¿™æ˜¯å‡ºäºæ•ˆèƒ½ä¸Šçš„è€ƒé‡ã€‚åˆ«å¿˜äº†ï¼Œä½ è¦æ‰§è¡Œè¿™æ ·çš„æ¯”è¾ƒä¹Ÿæ˜¯ä¼šåƒèµ„æºçš„ï¼Œå°¤å…¶æ˜¯åœ¨ä½ çš„å¯¹è±¡å¾ˆæ·±å¾ˆæ·±çš„æ—¶å€™ï¼Œè¦æ¯”è¾ƒçš„ä¸œè¥¿å¯å°±å¤šäº†ï¼Œå› æ­¤æˆ‘ä»¬ä¼šå€¾å‘ç”¨<code>shallowEqual</code>ï¼Œåªè¦æ¯”è¾ƒä¸€å±‚å³å¯ã€‚</p> <p>å¦å¤–ï¼Œå‰é¢æœ‰æåˆ°<code>PureComponent</code>è¿™ä¸ªä¸œè¥¿ï¼Œå…¶å®å°±æ˜¯ React æä¾›çš„å¦å¤–ä¸€ç§å…ƒä»¶ï¼ŒåŒºåˆ«å°±æ˜¯åœ¨äºå®ƒè‡ªåŠ¨å¸®ä½ åŠ ä¸Šä¸Šé¢é‚£ä¸€æ®µçš„æ¯”è¾ƒã€‚å¦‚æœä½ æƒ³çœ‹åŸå§‹ç çš„è¯ï¼Œ<a href="https://github.com/facebook/react/blob/1637b43e27c40c73f9489603145f9bb1d0ece618/packages/react-reconciler/src/ReactFiberClassComponent.js#L194" target="_blank" rel="noopener noreferrer">åœ¨è¿™è¾¹<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>type<span class="token punctuation">.</span>prototype <span class="token operator">&amp;&amp;</span> type<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>isPureReactComponent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token operator">!</span><span class="token function">shallowEqual</span><span class="token punctuation">(</span>oldProps<span class="token punctuation">,</span> newProps<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">shallowEqual</span><span class="token punctuation">(</span>oldState<span class="token punctuation">,</span> newState<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>è®²åˆ°è¿™è¾¹ï¼Œå°±å¯ä»¥æ¥å‘è¡¨ç¬¬äºŒé¢˜çš„è§£ç­”äº†ï¼Œç­”æ¡ˆæ˜¯ï¼š<code>A. æœƒï¼Œåœ¨é€™æƒ…æ³ä¸‹ PureComponent æœƒæ¯” Component æœ‰æ•ˆç‡</code>ï¼Œå› ä¸ºç»§æ‰¿äº† PureComponent ä¹‹åï¼Œåªè¦é“å…·è·ŸçŠ¶æ€æ²¡å˜ï¼Œå°±ä¸ä¼šæ‰§è¡Œ render å‡½æ•°ï¼Œä¹Ÿä¸ä¼šæ‰§è¡Œ virtual DOM diffï¼ŒèŠ‚çœäº†è®¸å¤šå¼€æ”¯ã€‚</p> <h3 id="shallowequal-èˆ‡-immutable-data-structures"><a href="#shallowequal-èˆ‡-immutable-data-structures" aria-hidden="true" class="header-anchor">#</a> shallowEqual èˆ‡ Immutable data structures</h3> <p>ä½ åˆšå¼€å§‹åœ¨å­¦ React çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šè¢«å‘Šè¯«è¯´å¦‚æœè¦æ›´æ”¹èµ„æ–™ï¼Œä¸èƒ½å¤Ÿè¿™æ ·å†™ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// ä¸èƒ½é€™æ¨£</span>
<span class="token keyword">const</span> newObject <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>obj<span class="token punctuation">;</span>
newObject<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  obj<span class="token punctuation">:</span> newObject
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ä¹Ÿä¸èƒ½é€™æ¨£</span>
<span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>arr<span class="token punctuation">;</span>
arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  list<span class="token punctuation">:</span> arr
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>ç”šè‡³åº”è¯¥è¦è¿™æ ·ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  obj<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>this<span class="token punctuation">.</span>state<span class="token punctuation">.</span>obj<span class="token punctuation">,</span>
    id<span class="token punctuation">:</span> <span class="token number">2</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  list<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token operator">...</span>this<span class="token punctuation">.</span>state<span class="token punctuation">.</span>arr<span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>ä½†ä½ çŸ¥é“ä¸ºä»€ä¹ˆå—ï¼Ÿ</p> <p>ä¸Šé¢æ‰€è¿°ï¼Œå®é™…ä¸Šä½¿ç”¨<code>PureComponent</code>æ˜¯ä¸€ä»¶å¾ˆæ­£å¸¸çš„äº‹æƒ…ï¼Œå› ä¸ºçŠ¶æ€è·Ÿ props å¦‚æœæ²¡å˜çš„è¯ï¼Œæœ¬æ¥å°±ä¸è¯¥è§¦å‘æ¸²æŸ“åŠŸèƒ½ã€‚</p> <p>è€Œåˆšåˆšä¹Ÿæè¿‡<code>PureComponent</code>ä¼šå¸®ä½ <code>shallowEqual</code>state è·Ÿ propsï¼Œæ±ºå®šè¦ä¸è¦å‘¼å« render functionã€‚
åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœä½ ç”¨ä¸€å¼€å§‹è®²çš„é‚£ç§å†™æ³•ï¼Œå°±ä¼šäº§ç”Ÿé—®é¢˜ï¼Œä¾‹å¦‚è¯´ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> newObject <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>obj<span class="token punctuation">;</span>
newObject<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  obj<span class="token punctuation">:</span> newObject
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>åœ¨ä¸Šé¢çš„ç¨‹åºç ä¸­ï¼Œå®é™…ä¸Š<code>this.state.obj</code>è·Ÿ<code>newObject</code>è¿˜æ˜¯æŒ‡å‘åŒä¸€ä¸ªç‰©ä»¶ï¼ŒæŒ‡å‘ç›¸åŒå—è®°å¿†ä½“ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬åœ¨åš<code>shallowEqual</code>çš„æ—¶å€™ï¼Œå°±ä¼šåˆ¤æ–­å‡ºè¿™ä¸¤ä¸ªä¸œè¥¿æ˜¯æ›¿ä»£çš„ï¼Œå°±ä¸ä¼šæ‰§è¡Œ render function äº†ã€‚</p> <p>åœ¨è¿™æ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦ä¸å¯å˜çš„æ•°æ®ï¼Œä¸å¯å˜ç¿»æˆä¸­æ–‡å°±æ˜¯æ°¸è¿œä¸å˜çš„ï¼Œæ„æ€æ˜¯ï¼šâ€œå½“ä¸€ä¸ªèµ„æ–™è¢«åˆ›å»ºä¹‹åï¼Œå°±æ°¸è¿œä¸ä¼šå˜äº†â€ã€‚é‚£å¦‚æœæˆ‘éœ€è¦æ›´æ”¹èµ„æ–™çš„è¯æ€ä¹ˆåŠå‘¢ï¼Ÿä½ å°±åªèƒ½åˆ›ä¸€ä¸ªæ–°çš„ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  id<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  text<span class="token punctuation">:</span> <span class="token string">&quot;hello&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

obj<span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token string">&quot;world&quot;</span><span class="token punctuation">;</span> <span class="token comment">// é€™æ¨£ä¸è¡Œï¼Œå› ç‚ºä½ æ”¹è®Šäº† obj é€™å€‹ç‰©ä»¶</span>

<span class="token comment">// ä½ å¿…é ˆè¦åƒé€™æ¨£å‰µé€ ä¸€å€‹æ–°çš„ç‰©ä»¶</span>
<span class="token keyword">const</span> newObj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>obj<span class="token punctuation">,</span>
  text<span class="token punctuation">:</span> <span class="token string">&quot;world&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>æœ‰äº† Immutable çš„æ¦‚å¿µä¹‹åï¼Œ<code>shallowEqual</code>å°±ä¸ä¼šå‡ºé”™äº†ï¼Œå› ä¸ºå¦‚æœæˆ‘ä»¬æœ‰æ–°çš„èµ„æ–™ï¼Œå°±å¯ä»¥ä¿è¯å®ƒæ˜¯ä¸€ä¸ªæ–°çš„ objectï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨ç”¨<code>setState</code>çš„æ—¶å€™æ€»æ˜¯è¦äº§ç”Ÿä¸€ä¸ªæ–°çš„ç‰©ä»¶ï¼Œè€Œä¸æ˜¯ç›´æ¥å¯¹ç°æœ‰çš„åšæ“ä½œã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// æ²’æœ‰ Immutable çš„æ¦‚å¿µå‰</span>
<span class="token keyword">const</span> props <span class="token operator">=</span> <span class="token punctuation">{</span>
  id<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  list<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> list <span class="token operator">=</span> props<span class="token punctuation">.</span>list<span class="token punctuation">;</span>
list<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
nextProps <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>props<span class="token punctuation">,</span>
  list
<span class="token punctuation">}</span><span class="token punctuation">;</span>

props<span class="token punctuation">.</span>list <span class="token operator">===</span> nextProps<span class="token punctuation">.</span>list<span class="token punctuation">;</span> <span class="token comment">// true</span>

<span class="token comment">// æœ‰äº† Immutable çš„æ¦‚å¿µå¾Œ</span>
<span class="token keyword">const</span> props <span class="token operator">=</span> <span class="token punctuation">{</span>
  id<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  list<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> nextProps <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>props<span class="token punctuation">,</span>
  list<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token operator">...</span>props<span class="token punctuation">.</span>list<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

props<span class="token punctuation">.</span>list <span class="token operator">===</span> nextProps<span class="token punctuation">.</span>list<span class="token punctuation">;</span> <span class="token comment">// false</span>
</code></pre></div><p>è¿™è¾¹è¿˜æœ‰ä¸€ä¸ªè¦æ³¨æ„çš„åœ°æ–¹ï¼Œé‚£å°±æ˜¯ä¼ æ’­ç®—å­åªæ˜¯å¤åˆ¶ç¬¬ä¸€å±‚çš„èµ„æ–™è€Œå·²ï¼Œå®ƒå¹¶ä¸æ·±å…‹éš†ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> test <span class="token operator">=</span> <span class="token punctuation">{</span>
  a<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  nest<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    title<span class="token punctuation">:</span> <span class="token string">&quot;hello&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> copy <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>test <span class="token punctuation">}</span><span class="token punctuation">;</span>

copy<span class="token punctuation">.</span>nest <span class="token operator">===</span> test<span class="token punctuation">.</span>nest<span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre></div><p>æ‰€ä»¥å½“ä½ çš„çŠ¶æ€æ˜¯æ¯”è¾ƒå¤æ‚çš„ç»“æ„æ—¶ï¼Œè¦æ”¹å˜èµ„æ–™å°±ä¼šå˜å¾—å˜å¾—æ¯”è¾ƒéº»çƒ¦ä¸€ç‚¹ï¼Œå› ä¸ºä½ å¿…é¡»è¦å¯¹æ¯ä¸€å±‚éƒ½åšå·®ä¸å¤šçš„äº‹æƒ…ï¼Œé¿å…ç›´æ¥å»æ”¹åˆ°ä½ è¦æ”¹çš„ç‰©ä½“ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// æ²’æœ‰ Immutable çš„æ¦‚å¿µå‰</span>
<span class="token keyword">const</span> props <span class="token operator">=</span> <span class="token punctuation">{</span>
  title<span class="token punctuation">:</span> <span class="token string">&quot;123&quot;</span><span class="token punctuation">,</span>
  list<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      id<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      name<span class="token punctuation">:</span> <span class="token string">&quot;hello&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      id<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
      name<span class="token punctuation">:</span> <span class="token string">&quot;world&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> list <span class="token operator">=</span> props<span class="token punctuation">.</span>list<span class="token punctuation">;</span>
list<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;world2&quot;</span><span class="token punctuation">;</span> <span class="token comment">// ç›´æ¥æ”¹</span>
nextProps <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>props<span class="token punctuation">,</span>
  list
<span class="token punctuation">}</span><span class="token punctuation">;</span>

props<span class="token punctuation">.</span>list <span class="token operator">===</span> nextProps<span class="token punctuation">.</span>list<span class="token punctuation">;</span> <span class="token comment">// true</span>
props<span class="token punctuation">.</span>list<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">===</span> nextProps<span class="token punctuation">.</span>list<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// true</span>

<span class="token comment">// æœ‰äº† Immutable çš„æ¦‚å¿µå¾Œ</span>
<span class="token keyword">const</span> props <span class="token operator">=</span> <span class="token punctuation">{</span>
  title<span class="token punctuation">:</span> <span class="token string">&quot;123&quot;</span><span class="token punctuation">,</span>
  list<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      id<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      name<span class="token punctuation">:</span> <span class="token string">&quot;hello&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      id<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
      name<span class="token punctuation">:</span> <span class="token string">&quot;world&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// è¦æ³¨æ„é€™é‚Šåªæ˜¯ shallow copy è€Œå·²</span>
<span class="token comment">// list[0] === props.list[0] =&gt; true</span>
<span class="token keyword">const</span> list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>props<span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> data <span class="token operator">=</span> props<span class="token punctuation">.</span>list<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> nextProps <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>props<span class="token punctuation">,</span>
  list<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token operator">...</span>list<span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token operator">...</span>data<span class="token punctuation">,</span> <span class="token comment">// å†åšä¸€æ¬¡ spread oprator</span>
      name<span class="token punctuation">:</span> <span class="token string">&quot;world2&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

props<span class="token punctuation">.</span>list <span class="token operator">===</span> nextProps<span class="token punctuation">.</span>list<span class="token punctuation">;</span> <span class="token comment">// false</span>
props<span class="token punctuation">.</span>list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> nextProps<span class="token punctuation">.</span>list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
props<span class="token punctuation">.</span>list<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">===</span> nextProps<span class="token punctuation">.</span>list<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
</code></pre></div><p>è‹¥ä½ çš„çŠ¶æ€ç»“æ„å¾ˆå¤šå±‚ï¼Œé‚£å°±ä¼šå˜å¾—éå¸¸éå¸¸éš¾æ”¹ï¼Œè¿™æ—¶å€™ä½ æœ‰ä¸‰ä¸ªé€‰æ‹©ï¼š</p> <ol><li>é¿å…å¤ªå¤šå¤šå±‚çš„çŠ¶æ€ï¼Œå°½é‡å‹å¹³ï¼ˆå¯å‚è€ƒ<a href="https://github.com/paularmstrong/normalizr" target="_blank" rel="noopener noreferrer">normalizr<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>ï¼‰</li> <li>æ‰¾ä¸€ä¸ªä¼šå¸®ä½ åšä¸å¯å˜çš„åº“ï¼Œä¾‹å¦‚è¯´ Facebook çš„<a href="https://facebook.github.io/immutable-js/" target="_blank" rel="noopener noreferrer">Immutable.js<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>ç›´æ¥ç”¨ deep clone æŠŠèµ„æ–™å…¨éƒ¨å¤åˆ¶ä¸‹æ¥ï¼Œä¹‹åä½ çˆ±æ€ä¹ˆæ”¹å°±æ€ä¹ˆæ”¹ï¼ˆä¸æ¨èï¼‰</li></ol> <p>æ³¨ï¼šæ„Ÿè°¢ç½‘å‹ KanYueh Chen çš„æŒ‡æ­£ï¼Œè®©æˆ‘è¡¥ä¸Šä¸Šé¢è¿™ä¸€æ®µã€‚</p> <h3 id="purecomponent-çš„é™·é˜±"><a href="#purecomponent-çš„é™·é˜±" aria-hidden="true" class="header-anchor">#</a> PureComponent çš„é™·é˜±</h3> <p>å½“æˆ‘ä»¬éµå®ˆ Immutable çš„è§„åˆ™ä¹‹åï¼Œç†æ‰€å½“ç„¶çš„å°±ä¼šæƒ³æŠŠæ‰€æœ‰çš„ Component éƒ½è®¾æˆã€‚</p> <p>é‚£è®©æˆ‘ä»¬å›å¤´æ¥çœ‹å¼€åœºå°æµ‹éªŒçš„æœ€åä¸€é¢˜ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Row</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> item<span class="token punctuation">,</span> style <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>tr style<span class="token operator">=</span><span class="token punctuation">{</span>style<span class="token punctuation">}</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>td<span class="token operator">&gt;</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>id<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>td<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>tr<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Table</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> list <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>
    <span class="token keyword">const</span> itemStyle <span class="token operator">=</span> <span class="token punctuation">{</span>
      color<span class="token punctuation">:</span> <span class="token string">&quot;red&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>table<span class="token operator">&gt;</span>
        <span class="token punctuation">{</span>list<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
          <span class="token operator">&lt;</span>Row key<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>id<span class="token punctuation">}</span> item<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">}</span> style<span class="token operator">=</span><span class="token punctuation">{</span>itemStyle<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>table<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>æˆ‘ä»¬æŠŠ<code>Row</code>å˜æˆäº† PureComponentï¼Œæ‰€ä»¥åªè¦çŠ¶æ€è·Ÿ props æ²¡å˜ï¼Œå°±ä¸ä¼š re-renderï¼Œæ‰€ä»¥ç­”æ¡ˆåº”è¯¥è¦æ˜¯<code>A. æœƒï¼Œåœ¨é€™æƒ…æ³ä¸‹ PureComponent æœƒæ¯” Component æœ‰æ•ˆç‡</code>ï¼Ÿ</p> <p>é”™ï¼Œå¦‚æœä½ æŠŠç¨‹å¼ç çœ‹æ›´æ¸…æ¥šä¸€ç‚¹ï¼Œä½ ä¼šå‘ç°ç­”æ¡ˆå…¶å®æ˜¯<code>C. ä¸æœƒï¼Œåœ¨é€™æƒ…æ³ä¸‹ Component æœƒæ¯” PureComponent æœ‰æ•ˆç‡</code>ã€‚</p> <p>ä½ çš„æ­£ç¡®æ˜¯å¯¹çš„ï¼Œâ€œåªè¦çŠ¶æ€è·Ÿ props æ²¡å˜ï¼Œå°±ä¸ä¼šé‡æ–°æ¸²æŸ“ï¼ŒPureComponent å°±ä¼šæ¯” Component æ•ˆç‡â€ã€‚ä½†å®é™…ä¸Šè¿˜æœ‰å¦å¤–ä¸€å¥è¯ä¹Ÿæ˜¯å¯¹çš„ï¼šâ€œå¦‚æœä½ çš„ state æˆ– props ã€æ°¸è¿œéƒ½ä¼šå˜ã€ï¼Œé‚£ PureComponent å¹¶ä¸ä¼šæ¯”è¾ƒå¿«ã€ã€‚</p> <p>æ‰€ä»¥è¿™ä¸¤ç§çš„ä½¿ç”¨æ—¶æœºå·®å¼‚åœ¨äºï¼šstate è·Ÿ props åˆ°åº•å¸¸å¸¸ä¼šå˜è¿˜æ˜¯ä¸ä¼šå˜ï¼Ÿ</p> <p>ä¸Šè¿°çš„ç¤ºä¾‹ä¸­ï¼Œé™·é˜±åœ¨äº<code>itemStyle</code>è¿™ä¸ª propsï¼Œæˆ‘ä»¬æ¯æ¬¡ render çš„æ—¶å€™éƒ½åˆ›é€ äº†ä¸€ä¸ªæ–°çš„ç‰©ä»¶ï¼Œæ‰€ä»¥å¯¹ Row æ¥è¯´ï¼Œå°½ç®¡ props.item æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯ props.style å´æ˜¯â€œæ¯æ¬¡éƒ½ä¸ä¸€æ ·â€ã€‚</p> <p>å¦‚æœä½ å·²ç»çŸ¥é“æ¯æ¬¡éƒ½ä¼šä¸ä¸€æ ·ï¼Œé‚£ PureComponent è¿™æ—¶å€™å°±æ— ç”¨æ­¦ä¹‹åœ°äº†ï¼Œè€Œä¸”è¿˜æ›´ç³Ÿã€‚ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºå®ƒå¸®ä½ åšäº†<code>shallowEqual</code>ã€‚</p> <p>åˆ«å¿˜è®°äº†ï¼Œä¹Ÿæ˜¯<code>shallowEqual</code>éœ€è¦æ‰§è¡Œæ—¶é—´çš„ã€‚</p> <p>å·²ç»çŸ¥é“ props çš„æ¯”è¾ƒæ¯æ¬¡éƒ½å¤±è´¥çš„è¯ï¼Œé‚£ä¸å¦‚ä¸è¦æ¯”å³å°†æ¥åˆ°çš„æ¯”è¾ƒå¿«ï¼Œæ‰€ä»¥åœ¨è¿™ä¸ªæœ‰æ„ä¹‰ä¸‹ï¼ŒComponent ä¼šæ¯” PureComponent æœ‰æ•ˆç‡ï¼Œå› ä¸ºä¸ç”¨åš<code>shallowEqual</code>ã€‚</p> <p>è¿™å°±æ˜¯æˆ‘å¼€å¤´æåˆ°çš„éœ€è¦ç‰¹åˆ«æ³¨æ„çš„éƒ¨åˆ†ã€‚ä¸è¦ä»¥ä¸ºä½ æŠŠæ¯ä¸ª Component éƒ½æ¢æˆ PureComponent å°±å¤©ä¸‹å¤ªå¹³ï¼ŒApp å˜è¶…å¿«ï¼Œæ€§èƒ½æå‡å¥½å‡ å€ã€‚ä¸å»æ³¨æ„è¿™äº›ç»†èŠ‚çš„è¯ï¼Œå°±æœ‰å¯èƒ½æŠŠæ•ˆèƒ½è¶Šå¼„è¶Šç³Ÿã€‚</p> <p>æœ€åå†ç²¾é€‰ä¸€æ¬¡ï¼Œå¦‚æœä½ å·²ç»é¢„æœŸåˆ°æŸä¸ª component çš„é“å…·æˆ–è€…çŠ¶æ€ä¼šâ€œå¾ˆå®¹æ˜“å˜åŠ¨â€ï¼Œé‚£ä½ æ ¹æœ¬ä¸ç”¨æ¢æˆ PureComponentï¼Œå› ä¸ºä½ å®ä½œä¹‹ååè€Œä¼šå˜å¾—æ›´æ…¢ã€‚</p> <p>åœ¨ç ”ç©¶è¿™äº›æ€§èƒ½ç›¸å…³çš„é—®é¢˜æ—¶ï¼Œæˆ‘æœ€æ¨èçš„å†…å®¹ï¼š<a href="https://cdb.reacttraining.com/react-inline-functions-and-performance-bdff784f5578" target="_blank" rel="noopener noreferrer">ååº”ï¼Œå†…è”å‡½æ•°å’Œæ€§èƒ½<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>ï¼Œè§£å¼€äº†å¾ˆå¤šæˆ‘å¿ƒä¸­çš„ç–‘æƒ‘ä»¥åŠå¸¦ç»™æˆ‘å¾ˆå¤šæ–°çš„æƒ³æ³•ã€‚</p> <p>ä¾‹å¦‚è¯´æ–‡æœ«æåˆ°çš„ PureComponent æœ‰æ—¶å€™åè€Œä¼šå˜æ…¢ï¼Œä¹Ÿæ˜¯ä»è¿™ç¯‡æ–‡ç« çœ‹æ¥çš„ï¼ŒçœŸå¿ƒæ¨èå¤§å®¶æŠ½ç©ºå»çœ‹çœ‹ã€‚</p> <p>å‰é˜µå­è·ŸåŒäº‹ä¸€èµ·æŠŠä¸€ä¸ªä¸“æ¡ˆæ‰“æ‰é‡åšï¼ŒåŸæœ¬çš„å…±è¯†æ˜¯å°è¯•ç”¨ PureComponentï¼Œç›´åˆ°æˆ‘çœ‹åˆ°ä»‹ç»æ–‡å¹¶ä»”ç»†æ€è€ƒäº†ä¸€ä¸‹ï¼Œå‘ç°å¦‚æœä½ ä¸çŸ¥é“èƒŒåçš„åŸç†ï¼Œè¿˜æ˜¯ä¸è¦è½»æ˜“ä½¿ç”¨æ¯”è¾ƒå¥½ã€‚å› æ­¤æˆ‘å°±æœ‰æœ›æ”¹æˆå…¨éƒ¨ç”¨ç»„ä»¶ï¼Œç­‰æˆ‘ä»¬ç¢°åˆ°æ•ˆèƒ½é—®é¢˜è¦æ¥ä¼˜åŒ–æ—¶å†æ…¢æ…¢è°ƒæ•´ã€‚</p> <p>æœ€åé™„ä¸Šä¸€å¥æˆ‘å¾ˆå–œæ¬¢çš„è¯ï¼Œä»<a href="https://blog.wuct.me/react-%E5%B7%A2%E7%8B%80-component-%E6%95%88%E8%83%BD%E5%84%AA%E5%8C%96-b01d8a0d3eff" target="_blank" rel="noopener noreferrer">ååº”å·¢çŠ¶ Component æ•ˆèƒ½ä¼˜åŒ–æå‡º<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>çœ‹æ¥çš„ï¼ˆæ­¤å¤„ä¹Ÿæ˜¯åœ¨è®²æœ€åæåˆ°çš„ PureComponent çš„é—®é¢˜ï¼‰ï¼š</p> <blockquote><p>è™½ç„¶ä½ çŸ¥é“å¯ä»¥ä¼˜åŒ–ï¼Œä½†ä¸ä»£è¡¨ä½ åº”è¯¥ä¼˜åŒ–ã€‚</p></blockquote> <p><img src="http://book.52react.cn/20191118122854.png" alt></p> <h2 id="å‚è€ƒèµ„æ–™ï¼š"><a href="#å‚è€ƒèµ„æ–™ï¼š" aria-hidden="true" class="header-anchor">#</a> å‚è€ƒèµ„æ–™ï¼š</h2> <p><a href="https://medium.freecodecamp.org/make-react-fast-again-tools-and-techniques-for-speeding-up-your-react-app-7ad39d3c1b82" target="_blank" rel="noopener noreferrer">é«˜æ€§èƒ½ Reactï¼š3 ä¸ªåŠ é€Ÿåº”ç”¨ç¨‹åºçš„æ–°å·¥å…·<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br> <a href="https://reactjs.org/docs/reconciliation.html#motivation" target="_blank" rel="noopener noreferrer">reactjs-å¯¹å¸<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br> <a href="https://reactjs.org/docs/optimizing-performance.html" target="_blank" rel="noopener noreferrer">reactjs-ä¼˜åŒ–æ€§èƒ½<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br> <a href="https://marmelab.com/blog/2017/02/06/react-is-slow-react-is-fast.html" target="_blank" rel="noopener noreferrer">React è¿è¡Œç¼“æ…¢ï¼ŒReact å¿«é€Ÿï¼šåœ¨å®è·µä¸­ä¼˜åŒ– React Apps<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br> <a href="https://www.toptal.com/react/optimizing-react-performance" target="_blank" rel="noopener noreferrer">é«˜æ•ˆçš„ React ç»„ä»¶ï¼šä¼˜åŒ– React æ€§èƒ½çš„æŒ‡å—<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/bookNotes/assets/js/app.a5c1f5ee.js" defer></script><script src="/bookNotes/assets/js/73.2a333618.js" defer></script>
  </body>
</html>
