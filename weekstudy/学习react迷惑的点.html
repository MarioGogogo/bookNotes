<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>学习react迷惑的点 | 👨🏽‍💻前端漫游指南</title>
    <meta name="description" content="Never Stop Learning">
    <link rel="icon" href="/bookNotes/favicon.ico">
    
    <link rel="preload" href="/bookNotes/assets/css/0.styles.02a9e5b3.css" as="style"><link rel="preload" href="/bookNotes/assets/js/app.a5c1f5ee.js" as="script"><link rel="preload" href="/bookNotes/assets/js/87.8a9e4f11.js" as="script"><link rel="prefetch" href="/bookNotes/assets/js/10.7897844d.js"><link rel="prefetch" href="/bookNotes/assets/js/11.daa46aa2.js"><link rel="prefetch" href="/bookNotes/assets/js/12.19efc583.js"><link rel="prefetch" href="/bookNotes/assets/js/13.5b7f839d.js"><link rel="prefetch" href="/bookNotes/assets/js/14.47b4842d.js"><link rel="prefetch" href="/bookNotes/assets/js/15.959aa0c7.js"><link rel="prefetch" href="/bookNotes/assets/js/16.e07efd9a.js"><link rel="prefetch" href="/bookNotes/assets/js/17.06df2fb1.js"><link rel="prefetch" href="/bookNotes/assets/js/18.40dee455.js"><link rel="prefetch" href="/bookNotes/assets/js/19.ea09a6c5.js"><link rel="prefetch" href="/bookNotes/assets/js/2.2daf200c.js"><link rel="prefetch" href="/bookNotes/assets/js/20.ffb27053.js"><link rel="prefetch" href="/bookNotes/assets/js/21.33f73e1d.js"><link rel="prefetch" href="/bookNotes/assets/js/22.9e99b0e5.js"><link rel="prefetch" href="/bookNotes/assets/js/23.5417826f.js"><link rel="prefetch" href="/bookNotes/assets/js/24.59000dfc.js"><link rel="prefetch" href="/bookNotes/assets/js/25.acc91333.js"><link rel="prefetch" href="/bookNotes/assets/js/26.6af21f36.js"><link rel="prefetch" href="/bookNotes/assets/js/27.3d2e96f4.js"><link rel="prefetch" href="/bookNotes/assets/js/28.262d38c6.js"><link rel="prefetch" href="/bookNotes/assets/js/29.1eca77c6.js"><link rel="prefetch" href="/bookNotes/assets/js/3.2e998a1c.js"><link rel="prefetch" href="/bookNotes/assets/js/30.af641b29.js"><link rel="prefetch" href="/bookNotes/assets/js/31.3c9c863c.js"><link rel="prefetch" href="/bookNotes/assets/js/32.07ea838c.js"><link rel="prefetch" href="/bookNotes/assets/js/33.acab53c4.js"><link rel="prefetch" href="/bookNotes/assets/js/34.48dd7240.js"><link rel="prefetch" href="/bookNotes/assets/js/35.7c3ec624.js"><link rel="prefetch" href="/bookNotes/assets/js/36.ccd745ec.js"><link rel="prefetch" href="/bookNotes/assets/js/37.005d8f1b.js"><link rel="prefetch" href="/bookNotes/assets/js/38.fc6a5f21.js"><link rel="prefetch" href="/bookNotes/assets/js/39.44489367.js"><link rel="prefetch" href="/bookNotes/assets/js/4.dd5fac1d.js"><link rel="prefetch" href="/bookNotes/assets/js/40.34c225a3.js"><link rel="prefetch" href="/bookNotes/assets/js/41.1e7d641f.js"><link rel="prefetch" href="/bookNotes/assets/js/42.236029dd.js"><link rel="prefetch" href="/bookNotes/assets/js/43.09a1cad0.js"><link rel="prefetch" href="/bookNotes/assets/js/44.8165a802.js"><link rel="prefetch" href="/bookNotes/assets/js/45.01f5f11f.js"><link rel="prefetch" href="/bookNotes/assets/js/46.46b782a7.js"><link rel="prefetch" href="/bookNotes/assets/js/47.1ec61019.js"><link rel="prefetch" href="/bookNotes/assets/js/48.625d747e.js"><link rel="prefetch" href="/bookNotes/assets/js/49.f97abe71.js"><link rel="prefetch" href="/bookNotes/assets/js/5.dd4a8225.js"><link rel="prefetch" href="/bookNotes/assets/js/50.68dee525.js"><link rel="prefetch" href="/bookNotes/assets/js/51.583184a8.js"><link rel="prefetch" href="/bookNotes/assets/js/52.c7af0993.js"><link rel="prefetch" href="/bookNotes/assets/js/53.b647ed86.js"><link rel="prefetch" href="/bookNotes/assets/js/54.a5fbaa3d.js"><link rel="prefetch" href="/bookNotes/assets/js/55.a7b560d2.js"><link rel="prefetch" href="/bookNotes/assets/js/56.33015b4d.js"><link rel="prefetch" href="/bookNotes/assets/js/57.80ffe644.js"><link rel="prefetch" href="/bookNotes/assets/js/58.11a6edd1.js"><link rel="prefetch" href="/bookNotes/assets/js/59.e8bead8f.js"><link rel="prefetch" href="/bookNotes/assets/js/6.4505f2dd.js"><link rel="prefetch" href="/bookNotes/assets/js/60.cda1b788.js"><link rel="prefetch" href="/bookNotes/assets/js/61.16b57984.js"><link rel="prefetch" href="/bookNotes/assets/js/62.0476eb6a.js"><link rel="prefetch" href="/bookNotes/assets/js/63.f31d1faa.js"><link rel="prefetch" href="/bookNotes/assets/js/64.2e35d3be.js"><link rel="prefetch" href="/bookNotes/assets/js/65.e4ba2ad2.js"><link rel="prefetch" href="/bookNotes/assets/js/66.c2f247d4.js"><link rel="prefetch" href="/bookNotes/assets/js/67.393df1f2.js"><link rel="prefetch" href="/bookNotes/assets/js/68.875cabd4.js"><link rel="prefetch" href="/bookNotes/assets/js/69.54e25a4e.js"><link rel="prefetch" href="/bookNotes/assets/js/7.670f9f76.js"><link rel="prefetch" href="/bookNotes/assets/js/70.17e6d438.js"><link rel="prefetch" href="/bookNotes/assets/js/71.95131df7.js"><link rel="prefetch" href="/bookNotes/assets/js/72.83e3f4f8.js"><link rel="prefetch" href="/bookNotes/assets/js/73.2a333618.js"><link rel="prefetch" href="/bookNotes/assets/js/74.13fba1a5.js"><link rel="prefetch" href="/bookNotes/assets/js/75.8ea1e0ca.js"><link rel="prefetch" href="/bookNotes/assets/js/76.1bd9ac71.js"><link rel="prefetch" href="/bookNotes/assets/js/77.470d01e4.js"><link rel="prefetch" href="/bookNotes/assets/js/78.29be0910.js"><link rel="prefetch" href="/bookNotes/assets/js/79.0da8502d.js"><link rel="prefetch" href="/bookNotes/assets/js/8.3c63f96d.js"><link rel="prefetch" href="/bookNotes/assets/js/80.f840286c.js"><link rel="prefetch" href="/bookNotes/assets/js/81.8dc38613.js"><link rel="prefetch" href="/bookNotes/assets/js/82.63f9f794.js"><link rel="prefetch" href="/bookNotes/assets/js/83.92125d6e.js"><link rel="prefetch" href="/bookNotes/assets/js/84.2dd13e00.js"><link rel="prefetch" href="/bookNotes/assets/js/85.90ac8d90.js"><link rel="prefetch" href="/bookNotes/assets/js/86.00a9730f.js"><link rel="prefetch" href="/bookNotes/assets/js/88.4b63d7ed.js"><link rel="prefetch" href="/bookNotes/assets/js/89.8cbf23b4.js"><link rel="prefetch" href="/bookNotes/assets/js/9.2033ddc1.js"><link rel="prefetch" href="/bookNotes/assets/js/90.871ef198.js"><link rel="prefetch" href="/bookNotes/assets/js/91.f87deae7.js"><link rel="prefetch" href="/bookNotes/assets/js/92.3eb8316d.js"><link rel="prefetch" href="/bookNotes/assets/js/93.ccc52aee.js"><link rel="prefetch" href="/bookNotes/assets/js/94.17ce85a1.js"><link rel="prefetch" href="/bookNotes/assets/js/95.490c860d.js"><link rel="prefetch" href="/bookNotes/assets/js/96.ed694272.js"><link rel="prefetch" href="/bookNotes/assets/js/97.e9cae244.js">
    <link rel="stylesheet" href="/bookNotes/assets/css/0.styles.02a9e5b3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/bookNotes/" class="home-link router-link-active"><!----> <span class="site-name">👨🏽‍💻前端漫游指南</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/bookNotes/macosguide/" class="nav-link">MacOS配置</a></div><div class="nav-item"><a href="/bookNotes/weekstudy/" class="nav-link router-link-active">周学系列</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">学习系列</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/bookNotes/cssmagic/" class="nav-link">CSS揭秘</a></li><li class="dropdown-item"><!----> <a href="/bookNotes/algorithm/" class="nav-link">前端数据结构与算法</a></li><li class="dropdown-item"><!----> <a href="/bookNotes/interview/" class="nav-link">面试知多少</a></li><li class="dropdown-item"><!----> <a href="/bookNotes/reactstatus/" class="nav-link">React状态管理与同构实战</a></li><li class="dropdown-item"><!----> <a href="/bookNotes/koa2/" class="nav-link">Koa2系列</a></li><li class="dropdown-item"><!----> <a href="/bookNotes/nodejs/" class="nav-link">Nodejs系列</a></li></ul></div></div><div class="nav-item"><a href="http://h5web.cc/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">GitHub</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/MarioGogogo" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub地址
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/MarioGogogo/react" target="_blank" rel="noopener noreferrer" class="nav-link external">
  算法仓库
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/bookNotes/macosguide/" class="nav-link">MacOS配置</a></div><div class="nav-item"><a href="/bookNotes/weekstudy/" class="nav-link router-link-active">周学系列</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">学习系列</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/bookNotes/cssmagic/" class="nav-link">CSS揭秘</a></li><li class="dropdown-item"><!----> <a href="/bookNotes/algorithm/" class="nav-link">前端数据结构与算法</a></li><li class="dropdown-item"><!----> <a href="/bookNotes/interview/" class="nav-link">面试知多少</a></li><li class="dropdown-item"><!----> <a href="/bookNotes/reactstatus/" class="nav-link">React状态管理与同构实战</a></li><li class="dropdown-item"><!----> <a href="/bookNotes/koa2/" class="nav-link">Koa2系列</a></li><li class="dropdown-item"><!----> <a href="/bookNotes/nodejs/" class="nav-link">Nodejs系列</a></li></ul></div></div><div class="nav-item"><a href="http://h5web.cc/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">GitHub</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/MarioGogogo" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub地址
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/MarioGogogo/react" target="_blank" rel="noopener noreferrer" class="nav-link external">
  算法仓库
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/bookNotes/weekstudy/" class="sidebar-link">用好谷歌!!!(重点)</a></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>2019年38周</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>2019年39周</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>2019年40周</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>2019年41周</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>2019年42周</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>2019年43周</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>2019年44周</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>2019年45周</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>2019年46周</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/bookNotes/weekstudy/State设计Redux开发第一步.html" class="sidebar-link">State 设计 Redux 开发第一步</a></li><li><a href="/bookNotes/weekstudy/学习react迷惑的点.html" class="active sidebar-link">学习react迷惑的点</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/bookNotes/weekstudy/学习react迷惑的点.html#参考" class="sidebar-link">参考</a></li></ul></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>2019年47周</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>2019年48周</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>2019年49周</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>2019年51周</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>2019年52周</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="学习react迷惑的点"><a href="#学习react迷惑的点" aria-hidden="true" class="header-anchor">#</a> 学习react迷惑的点</h1> <p>原文地址 https://mp.weixin.qq.com/s/GR_J26IkO-o2Ki8DunMJNg</p> <blockquote><p>新手学习 React 的时候容易迷惑的点写出来</p></blockquote> <h3 id="为什么要引入-react"><a href="#为什么要引入-react" aria-hidden="true" class="header-anchor">#</a> 为什么要引入 React</h3> <p>在写 React 的时候，你可能会写类似这样的代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">function</span> <span class="token constant">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...other code</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>前端桃园<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>你肯定疑惑过，下面的代码都没有用到 React，为什么要引入 React 呢？</p> <p>如果你把 <strong>import React from ‘react’</strong> 删掉，还会报下面这样的错误：
<img src="http://book.52react.cn/20191119224155.png" alt></p> <p>那么究竟是哪里用到了这个 React，导致我们引入 React 会报错呢，不懂这个原因，那么就是 JSX 没有搞得太明白。</p> <p>你可以讲上面的代码(忽略导入语句)放到在线 babel 里进行转化一下，发现 babel 会把上面的代码转化成:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token constant">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...other code</span>
  <span class="token keyword">return</span> React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;h1&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;前端桃园&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>因为从本质上讲，JSX 只是为 <strong>React.createElement(component, props, ...children)</strong> 函数提供的语法糖。</p> <h3 id="为什么要用-classname-而不用-class"><a href="#为什么要用-classname-而不用-class" aria-hidden="true" class="header-anchor">#</a> 为什么要用 className 而不用 class</h3> <p>React 一开始的理念是想与浏览器的 DOM API 保持一致而不是 HTML，因为 JSX 是 JS 的扩展，而不是用来代替 HTML 的，这样会和元素的创建更为接近。在元素上设置 <code>class</code> 需要使用 <code>className</code> 这个 API：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> element <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">)</span>
element<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">&quot;hello&quot;</span> 
</code></pre></div><p>浏览器问题，ES5 之前，在对象中不能使用保留字。以下代码在 IE8 中将会抛出错误：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> element <span class="token operator">=</span> <span class="token punctuation">{</span>
 attributes<span class="token punctuation">:</span> <span class="token punctuation">{</span>
   <span class="token keyword">class</span><span class="token punctuation">:</span> <span class="token string">&quot;hello&quot;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span> 
</code></pre></div><p>解构问题，当你在解构属性的时候，如果分配一个 class 变量会出问题</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">class</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token keyword">class</span><span class="token punctuation">:</span> <span class="token string">'foo'</span> <span class="token punctuation">}</span> <span class="token comment">// Uncaught SyntaxError: Unexpected token }</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> className <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span> className<span class="token punctuation">:</span> <span class="token string">'foo'</span> <span class="token punctuation">}</span> 
<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">class</span><span class="token punctuation">:</span> className <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token keyword">class</span><span class="token punctuation">:</span> <span class="token string">'foo'</span> <span class="token punctuation">}</span> 
</code></pre></div><p>其他讨论可见：有趣的话题，为什么jsx用className而不是class</p> <h3 id="为什么属性要用小驼峰"><a href="#为什么属性要用小驼峰" aria-hidden="true" class="header-anchor">#</a> 为什么属性要用小驼峰</h3> <p>因为 JSX 语法上更接近 JavaScript 而不是 HTML，所以 React DOM 使用 camelCase（小驼峰命名）来定义属性的名称，而不使用 HTML 属性名称的命名约定。</p> <h3 id="为什么-constructor-里要调用-super-和传递-props"><a href="#为什么-constructor-里要调用-super-和传递-props" aria-hidden="true" class="header-anchor">#</a> 为什么 constructor 里要调用 super 和传递 props</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Clock</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>date<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>Hello<span class="token punctuation">,</span> world<span class="token operator">!</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>It is <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>date<span class="token punctuation">.</span><span class="token function">toLocaleTimeString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>而且有这么一段话，不仅让我们调用 super 还要把 props 传递进去，但是没有告诉我们为什么要这么做。</p> <p>不知道你有没有疑惑过为什么要调用 super 和传递 props，接下来我们来解开谜题吧。</p> <p>⭐ 为什么要调用 super</p> <p>其实这不是 React 的限制，这是 JavaScript 的限制，在<code>构造函数</code>里如果要调用 <code>this</code>，那么<code>提前</code>就要调用 super，在 React 里，我们常常会在构造函数里初始化 state，this.state = xxx ，所以需要调用 super。</p> <p>⭐ 为什么要传递 props</p> <p>你可能以为必须给 <code>super</code> 传入 <code>props</code>，否则 React.Component 就没法初始化 this.props：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>props <span class="token operator">=</span> props<span class="token punctuation">;</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>不过，如果你不小心漏传了 props，直接调用了 <code>super()</code>，你仍然可以在 render 和其他方法中访问 <code>this.props</code>（不信的话可以试试嘛）。</p> <p>为啥这样也行？因为React 会在构造函数被调用之后，会把 props 赋值给刚刚创建的实例对象：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">YourComponent</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
instance<span class="token punctuation">.</span>props <span class="token operator">=</span> props<span class="token punctuation">;</span>
</code></pre></div><p>props 不传也能用，是有原因的。</p> <p>但这意味着你在使用 React 时，可以用 super() 代替 super(props) 了么？</p> <p>那还是不行的，不然官网也不会建议你调用 props 了，虽然 React 会在构造函数运行之后，为 this.props 赋值，但在 super() 调用之后与构造函数结束之前， this.props 仍然是没法用的。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Inside React</span>
<span class="token keyword">class</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>props <span class="token operator">=</span> props<span class="token punctuation">;</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Inside your code</span>
<span class="token keyword">class</span> <span class="token class-name">Button</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 😬 忘了传入 props</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ✅ {}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 😬 undefined</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>要是构造函数中调用了某个访问 props 的方法，那这个 bug 就更难定位了。<strong>因此我强烈建议始终使用super(props)，即使这不是必须的</strong>：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Button</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ✅ We passed props</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ✅ {}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ✅ {}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上面的代码确保 this.props 始终是有值的。</p> <p>如果你想避免以上的问题，你可以通过class 属性提案 来简化代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Clock</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>date<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">//简写</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>Hello<span class="token punctuation">,</span> world<span class="token operator">!</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>It is <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>date<span class="token punctuation">.</span><span class="token function">toLocaleTimeString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="为什么组件用大写开头"><a href="#为什么组件用大写开头" aria-hidden="true" class="header-anchor">#</a> 为什么组件用大写开头</h3> <p>前面以及说过了，JSX 是 React.createElement(component, props, …children) 提供的语法糖，component 的类型是：string/ReactClass type，我们具体看一下在什么情况下会用到 string 类型，什么情况下用到 ReactClass type 类型</p> <ul><li><p>string 类型react会觉得他是一个原生dom节点</p></li> <li><p>ReactClass type 类型 自定义组件</p></li></ul> <p>例如（string）：在 jsx 中我们写一个</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>转换为js的时候就变成了</p> <div class="language-js extra-class"><pre class="language-js"><code>React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
</code></pre></div><p>例如（ReactClass type）：在jsx中我们写一个</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">MyDiv</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span>MyDiv<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>MyDiv<span class="token operator">&gt;</span>
</code></pre></div><p>转换为js的时候就变成了</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">MyDiv</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>MyDiv<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>上边的例子中如果将MyDiv中的首字母小写，如下</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">myDiv</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span>myDiv<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>myDiv<span class="token operator">&gt;</span>
</code></pre></div><p>转换为 js 的时候就变成了</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">MyDiv</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;myDiv&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>由于找不到 myDiv 这个 dom，所以就会报错。</p> <h3 id="为什么调用方法要-bind-this"><a href="#为什么调用方法要-bind-this" aria-hidden="true" class="header-anchor">#</a> 为什么调用方法要 bind this</h3> <p>前提知识：深刻的理解 JavaScript 中的 this</p> <p>相信刚写 React 的时候，很多朋友可能会写类似这样的代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">handleClick</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> xxx<span class="token punctuation">:</span> aaa <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleClick<span class="token punctuation">}</span><span class="token operator">&gt;</span>
        Click me
      <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>发现会报 this 是 undefined 的错，然后可能对事件处理比较疑惑，然后去看官网的事件处理有下面一段话：</p> <blockquote><p>你必须谨慎对待 JSX 回调函数中的 this，在 JavaScript 中，class 的方法默认不会绑定this。如果你忘记绑定 <code>this.handleClick</code>并把它传入了 onClick，当你调用这个函数的时候 this 的值为 undefined。这并不是 React 特有的行为；这其实与 JavaScript 函数工作原理有关。通常情况下，如果你没有在方法后面添加 ()，例如 onClick={this.handleClick}，你应该为这个方法绑定 this。</p></blockquote> <p>然后你看了官网的例子和建议之后，知道需要为事件处理函数绑定 this就能解决，想下面这样：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">handleClick</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> xxx<span class="token punctuation">:</span> aaa <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleClick</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
        Click me
      <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>但是可能你没有去思考过为什么需要 bind this？如果你不能理解的话，还是 js 的基础没有打好。</p> <p><strong>React 是如何处理事件的？</strong></p> <p>咱们先来了解一下 React 是如何处理事件的。</p> <p>React 的事件是合成事件， 内部原理非常复杂，我这里只把关键性，可以用来解答这个问题的原理部分进行介绍即可(后面应该会写一篇 react 的事件原理，敬请期待)。</p> <p>上篇文章已经说过，jsx 实际上是 React.createElement(component, props, …children) 函数提供的语法糖，那么这段 jsx 代码：</p> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleClick<span class="token punctuation">}</span><span class="token operator">&gt;</span>
     Click me
 <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
</code></pre></div><p>会被转化为</p> <div class="language-js extra-class"><pre class="language-js"><code>React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;button&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
     onClick<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handleClick
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;Click me&quot;</span><span class="token punctuation">)</span>
</code></pre></div><p>了解了上面的，然后简单的理解 <code>react</code> 如何处理事件的，React 在组件加载(mount)和更新(update)时，将事件通过 <code>addEventListener</code>  统一注册到 <code>document</code> 上，然后会有一个事件池<code>存储了所有的事件</code>，当事件触发的时候，通过 <code>dispatchEvent</code> 进行事件分发。</p> <p>所以你可以简单的理解为，最终 this.handleClick 会作为一个回调函数调用。</p> <p>理解了这个，然后再来看看回调函数为什么就会丢失 this。</p> <h4 id="this-简单回顾"><a href="#this-简单回顾" aria-hidden="true" class="header-anchor">#</a> this 简单回顾</h4> <blockquote><p>在函数内部，this的值取决于函数被调用的方式。</p></blockquote> <p>如果你不能理解上面那句话，那么你可能需要停下来阅读文章，去查一下相关资料，否则你可能看不懂下面的，如果你懒的话，就看为你准备好的 MDN 吧。</p> <p>通过上面对事件处理的介绍，来模拟一下在类组件的 render 函数中， 有点类似于做了这样的操作:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
    <span class="token function">sayThis</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 这里的 `this` 指向谁？</span>
     <span class="token punctuation">}</span>

     <span class="token function">exec</span> <span class="token punctuation">(</span><span class="token parameter">cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>

    <span class="token function">render</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sayThis<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
foo<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出结果是什么？</span>
</code></pre></div><p>你会发现最终结果输出的是 <code>undefined</code>，如果你不理解为什么输出的是 undefined，那么还是上面说的，需要去深刻的理解 <code>this</code> 的原理。如果你能理解输出的是 <code>undefined</code>，那么我觉得你就可以理解为什么需要 <code>bind this</code>了。</p> <p>那么你可能会问：<strong>为什么React没有自动的把 bind 集成到 render 方法中呢</strong>?在 exec 调用回调的时候绑定进去，像这样：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
    <span class="token function">sayThis</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 这里的 `this` 指向谁？</span>
     <span class="token punctuation">}</span>

     <span class="token function">exec</span> <span class="token punctuation">(</span><span class="token parameter">cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>

    <span class="token function">render</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sayThis<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
foo<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出结果是什么？</span>
</code></pre></div><p>因为 render 多次调用每次都要 bind 会影响性能，所以官方建议你自己在 constructor 中手动 bind 达到性能优化。</p> <p><strong>四种事件处理对比</strong></p> <p>对于事件处理的写法也有好几种，咱们来进行对比一下：</p> <ol><li>直接 bind this 型</li></ol> <p>就是像文章开始的那样，直接在事件那里 bind this</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">handleClick</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> xxx<span class="token punctuation">:</span> aaa <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleClick</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
        Click me
      <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>✅ 优点：写起来顺手，一口气就能把这个逻辑写完，不用移动光标到其他地方。</p> <p>❌ 缺点：性能不太好，这种方式跟 react 内部帮你 bind 一样的，<strong>每次 render 都会进行 bind</strong>，而且如果有两个元素的事件处理函数式同一个，也还是要进行 bind，这样会多写点代码，而且进行两次 bind，性能不是太好。(其实这点性能往往不会是性能瓶颈的地方，如果你觉得顺手，这样写完全没问题)</p> <ol><li>constuctor 手动 bind 型</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">constuctor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>handleClick <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleClick</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">handleClick</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> xxx<span class="token punctuation">:</span> aaa <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleClick<span class="token punctuation">}</span><span class="token operator">&gt;</span>
        Click me
      <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>✅ 优点：相比于第一种性能更好，因为构造函数只执行一次，那么只会 bind 一次，而且如果有多个元素都需要调用这个函数，也不需要重复 bind，基本上解决了第一种的两个缺点。</p> <p>❌ 缺点：没有明显缺点，硬要说的话就是太丑了，然后不顺手(我觉得丑，你觉得不丑就这么写就行了)。</p> <ol><li>箭头函数型</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">handleClick</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> xxx<span class="token punctuation">:</span> aaa <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleClick</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
        Click me
      <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>✅ 优点：顺手，好看。</p> <p>❌ 缺点：每次 render 都会重复创建函数，性能会差一点。</p> <ol start="4"><li>public class fields 型</li></ol> <p>这种 class fields还处于实验阶段，据我所知目前还没有被纳入标准，具体可见这里。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> xxx<span class="token punctuation">:</span> aaa <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleClick<span class="token punctuation">}</span><span class="token operator">&gt;</span>
        Click me
      <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>✅ 优点：好看，性能好。</p> <p>❌ 缺点：没有明显缺点，如果硬要说可能就是要多装一个 babel 插件来支持这种语法。</p> <p>总结
我平时用的就这四种写法，我这边从代码的美观性、性能以及是否顺手方便对各种写法做了简单的对比。其实每种方法在项目里用都是没什么问题的，性能方面基本上可以忽略，对于美观性和顺手比较主观，所以总体来说就是看大家的偏好咯，如果硬要推荐的话，我还是<code>比较推荐第四种写法</code>，美观而且不影响性能。</p> <h3 id="为什么要-setstate，而不是直接-this-state-xx-oo"><a href="#为什么要-setstate，而不是直接-this-state-xx-oo" aria-hidden="true" class="header-anchor">#</a> 为什么要 setState，而不是直接 this.state.xx = oo</h3> <p>这个问题是我们公司后端写 React 的时候提出的问题，为啥不能直接修改 state，要 setState 一下。我在想，从 vue 转到 React 可能也会有这种疑问，因为 vue 修改状态都是直接改的。</p> <p>如果我们了解 <code>setState</code> 的原理的话，可能就能解答这个问题了，setState 做的事情<code>不仅仅</code>只是修改了 <code>this.state</code> 的值，另外最重要的是它会触发 React 的更新机制，会进行 diff ，然后将 patch 部分更新到真实 dom 里。</p> <p>如果你直接 <code>this.state.xx == oo</code> 的话，state 的值确实会改，但是改了不会触发 UI 的更新，那就不是数据驱动了。</p> <p>那为什么 Vue 直接修改 data 可以触发 UI 的更新呢？因为 Vue 在创建 <code>UI</code> 的时候会把这些 <code>data 给收集起来</code>，并且在这些 data 的访问器属性 setter 进行了重写，在这个重写的方法里会去触发 UI 的更新。如果你想更多的了解 vue 的原理，可以去购买染陌大佬的剖析 Vue.js 内部运行机制。</p> <blockquote><p>不明白访问器属性的可以看这篇文章：深入理解JS里的对象</p></blockquote> <h3 id="setstate-是同步还是异步相关问题"><a href="#setstate-是同步还是异步相关问题" aria-hidden="true" class="header-anchor">#</a> setState 是同步还是异步相关问题</h3> <ol><li>setState 是同步还是异步？</li></ol> <p>我的回答是执行过程代码同步的，只是<code>合成事件</code>和<code>钩子函数</code>的调用顺序<strong>在更新之前</strong>，导致在合成事件和钩子函数中<strong>没法立马</strong>拿到更新后的值，形式了所谓的“异步”，所以表现出来有时是同步，有时是“异步”。</p> <ol start="2"><li>何时是同步，何时是异步呢？</li></ol> <p>只在合成事件和钩子函数中是“异步”的，在原生事件和 <code>setTimeout/setInterval</code>等原生 API 中都是同步的。简单的可以理解为被 React 控制的函数里面就会表现出“异步”，反之表现为同步。</p> <ol start="3"><li>那为什么会出现异步的情况呢？</li></ol> <p>为了做性能优化，将 state 的更新延缓到最后<code>批量合并再去渲染</code>对于应用的性能优化是有极大好处的，如果每次的状态改变都去重新渲染真实 dom，那么它将带来巨大的性能消耗。</p> <ol start="4"><li>那如何在表现出异步的函数里可以准确拿到更新后的 state 呢？</li></ol> <p>通过第二个参数 setState(partialState, callback) 中的 callback 拿到更新后的结果。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
   value<span class="token punctuation">:</span><span class="token string">'2'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
   <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'拿到最新state数据'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>或者可以通过给 setState 传递函数来表现出同步的情况：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> val<span class="token punctuation">:</span> newVal <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ol start="5"><li>那表现出异步的原理是怎么样的呢？</li></ol> <p>我这里还是用最简单的语言让你理解：在 React 的 setState 函数实现中，会根据 isBatchingUpdates(<code>默认是 false</code>) 变量判断是否直接更新 this.state 还是放到队列中稍后更新。然后有一个 batchedUpdate 函数，可以修改 isBatchingUpdates 为 true，当 React 调用事件处理函数之前，或者生命周期函数之前就会调用 batchedUpdate 函数，这样的话，setState 就不会同步更新 this.state，而是放到更新队列里面后续更新。</p> <p>这样你就可以理解为什么原生事件和 <code>setTimeout/setinterval</code> 里面调用 this.state 会同步更新了吧，因为通过这些函数调用的 React 没办法去调用 <code>batchedUpdate</code> 函数将 <code>isBatchingUpdates</code> 设置为 true，那么这个时候 setState 的时候默认就是 false，那么就会同步更新。</p> <h2 id="参考"><a href="#参考" aria-hidden="true" class="header-anchor">#</a> 参考</h2> <p><a href>React 中为什么要 bind this</a></p> <p><a href>《React 状态管理与同构实践》</a></p></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/bookNotes/assets/js/app.a5c1f5ee.js" defer></script><script src="/bookNotes/assets/js/87.8a9e4f11.js" defer></script>
  </body>
</html>
